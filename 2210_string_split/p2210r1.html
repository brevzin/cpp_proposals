<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="mpark/wg21" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2021-01-04" />
  <title>Superior String Splitting</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {  background-color: #f6f8fa; }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span. { } /* Normal */
      code span.al { color: #ff0000; } /* Alert */
      code span.an { } /* Annotation */
      code span.at { } /* Attribute */
      code span.bn { color: #9f6807; } /* BaseN */
      code span.bu { color: #9f6807; } /* BuiltIn */
      code span.cf { color: #00607c; } /* ControlFlow */
      code span.ch { color: #9f6807; } /* Char */
      code span.cn { } /* Constant */
      code span.co { color: #008000; font-style: italic; } /* Comment */
      code span.cv { color: #008000; font-style: italic; } /* CommentVar */
      code span.do { color: #008000; } /* Documentation */
      code span.dt { color: #00607c; } /* DataType */
      code span.dv { color: #9f6807; } /* DecVal */
      code span.er { color: #ff0000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #9f6807; } /* Float */
      code span.fu { } /* Function */
      code span.im { } /* Import */
      code span.in { color: #008000; } /* Information */
      code span.kw { color: #00607c; } /* Keyword */
      code span.op { color: #af1915; } /* Operator */
      code span.ot { } /* Other */
      code span.pp { color: #6f4e37; } /* Preprocessor */
      code span.re { } /* RegionMarker */
      code span.sc { color: #9f6807; } /* SpecialChar */
      code span.ss { color: #9f6807; } /* SpecialString */
      code span.st { color: #9f6807; } /* String */
      code span.va { } /* Variable */
      code span.vs { color: #9f6807; } /* VerbatimString */
      code span.wa { color: #008000; font-weight: bold; } /* Warning */
      code.diff {color: #898887}
      code.diff span.va {color: #006e28}
      code.diff span.st {color: #bf0303}
  </style>
  <style type="text/css">
body {
margin: 5em;
font-family: serif;

hyphens: auto;
line-height: 1.35;
}
div.wrapper {
max-width: 60em;
margin: auto;
}
ul {
list-style-type: none;
padding-left: 2em;
margin-top: -0.2em;
margin-bottom: -0.2em;
}
a {
text-decoration: none;
color: #4183C4;
}
a.hidden_link {
text-decoration: none;
color: inherit;
}
li {
margin-top: 0.6em;
margin-bottom: 0.6em;
}
h1, h2, h3, h4 {
position: relative;
line-height: 1;
}
a.self-link {
position: absolute;
top: 0;
left: calc(-1 * (3.5rem - 26px));
width: calc(3.5rem - 26px);
height: 2em;
text-align: center;
border: none;
transition: opacity .2s;
opacity: .5;
font-family: sans-serif;
font-weight: normal;
font-size: 83%;
}
a.self-link:hover { opacity: 1; }
a.self-link::before { content: "§"; }
ul > li:before {
content: "\2014";
position: absolute;
margin-left: -1.5em;
}
:target { background-color: #C9FBC9; }
:target .codeblock { background-color: #C9FBC9; }
:target ul { background-color: #C9FBC9; }
.abbr_ref { float: right; }
.folded_abbr_ref { float: right; }
:target .folded_abbr_ref { display: none; }
:target .unfolded_abbr_ref { float: right; display: inherit; }
.unfolded_abbr_ref { display: none; }
.secnum { display: inline-block; min-width: 35pt; }
.header-section-number { display: inline-block; min-width: 35pt; }
.annexnum { display: block; }
div.sourceLinkParent {
float: right;
}
a.sourceLink {
position: absolute;
opacity: 0;
margin-left: 10pt;
}
a.sourceLink:hover {
opacity: 1;
}
a.itemDeclLink {
position: absolute;
font-size: 75%;
text-align: right;
width: 5em;
opacity: 0;
}
a.itemDeclLink:hover { opacity: 1; }
span.marginalizedparent {
position: relative;
left: -5em;
}
li span.marginalizedparent { left: -7em; }
li ul > li span.marginalizedparent { left: -9em; }
li ul > li ul > li span.marginalizedparent { left: -11em; }
li ul > li ul > li ul > li span.marginalizedparent { left: -13em; }
div.footnoteNumberParent {
position: relative;
left: -4.7em;
}
a.marginalized {
position: absolute;
font-size: 75%;
text-align: right;
width: 5em;
}
a.enumerated_item_num {
position: relative;
left: -3.5em;
display: inline-block;
margin-right: -3em;
text-align: right;
width: 3em;
}
div.para { margin-bottom: 0.6em; margin-top: 0.6em; text-align: justify; }
div.section { text-align: justify; }
div.sentence { display: inline; }
span.indexparent {
display: inline;
position: relative;
float: right;
right: -1em;
}
a.index {
position: absolute;
display: none;
}
a.index:before { content: "⟵"; }

a.index:target {
display: inline;
}
.indexitems {
margin-left: 2em;
text-indent: -2em;
}
div.itemdescr {
margin-left: 3em;
}
.bnf {
font-family: serif;
margin-left: 40pt;
margin-top: 0.5em;
margin-bottom: 0.5em;
}
.ncbnf {
font-family: serif;
margin-top: 0.5em;
margin-bottom: 0.5em;
margin-left: 40pt;
}
.ncsimplebnf {
font-family: serif;
font-style: italic;
margin-top: 0.5em;
margin-bottom: 0.5em;
margin-left: 40pt;
background: inherit; 
}
span.textnormal {
font-style: normal;
font-family: serif;
white-space: normal;
display: inline-block;
}
span.rlap {
display: inline-block;
width: 0px;
}
span.descr { font-style: normal; font-family: serif; }
span.grammarterm { font-style: italic; }
span.term { font-style: italic; }
span.terminal { font-family: monospace; font-style: normal; }
span.nonterminal { font-style: italic; }
span.tcode { font-family: monospace; font-style: normal; }
span.textbf { font-weight: bold; }
span.textsc { font-variant: small-caps; }
a.nontermdef { font-style: italic; font-family: serif; }
span.emph { font-style: italic; }
span.techterm { font-style: italic; }
span.mathit { font-style: italic; }
span.mathsf { font-family: sans-serif; }
span.mathrm { font-family: serif; font-style: normal; }
span.textrm { font-family: serif; }
span.textsl { font-style: italic; }
span.mathtt { font-family: monospace; font-style: normal; }
span.mbox { font-family: serif; font-style: normal; }
span.ungap { display: inline-block; width: 2pt; }
span.textit { font-style: italic; }
span.texttt { font-family: monospace; }
span.tcode_in_codeblock { font-family: monospace; font-style: normal; }
span.phantom { color: white; }

span.math { font-style: normal; }
span.mathblock {
display: block;
margin-left: auto;
margin-right: auto;
margin-top: 1.2em;
margin-bottom: 1.2em;
text-align: center;
}
span.mathalpha {
font-style: italic;
}
span.synopsis {
font-weight: bold;
margin-top: 0.5em;
display: block;
}
span.definition {
font-weight: bold;
display: block;
}
.codeblock {
margin-left: 1.2em;
line-height: 127%;
}
.outputblock {
margin-left: 1.2em;
line-height: 127%;
}
div.itemdecl {
margin-top: 2ex;
}
code.itemdeclcode {
white-space: pre;
display: block;
}
span.textsuperscript {
vertical-align: super;
font-size: smaller;
line-height: 0;
}
.footnotenum { vertical-align: super; font-size: smaller; line-height: 0; }
.footnote {
font-size: small;
margin-left: 2em;
margin-right: 2em;
margin-top: 0.6em;
margin-bottom: 0.6em;
}
div.minipage {
display: inline-block;
margin-right: 3em;
}
div.numberedTable {
text-align: center;
margin: 2em;
}
div.figure {
text-align: center;
margin: 2em;
}
table {
border: 1px solid black;
border-collapse: collapse;
margin-left: auto;
margin-right: auto;
margin-top: 0.8em;
text-align: left;
hyphens: none; 
}
td, th {
padding-left: 1em;
padding-right: 1em;
vertical-align: top;
}
td.empty {
padding: 0px;
padding-left: 1px;
}
td.left {
text-align: left;
}
td.right {
text-align: right;
}
td.center {
text-align: center;
}
td.justify {
text-align: justify;
}
td.border {
border-left: 1px solid black;
}
tr.rowsep, td.cline {
border-top: 1px solid black;
}
tr.even, tr.odd {
border-bottom: 1px solid black;
}
tr.capsep {
border-top: 3px solid black;
border-top-style: double;
}
tr.header {
border-bottom: 3px solid black;
border-bottom-style: double;
}
th {
border-bottom: 1px solid black;
}
span.centry {
font-weight: bold;
}
div.table {
display: block;
margin-left: auto;
margin-right: auto;
text-align: center;
width: 90%;
}
span.indented {
display: block;
margin-left: 2em;
margin-bottom: 1em;
margin-top: 1em;
}
ol.enumeratea { list-style-type: none; background: inherit; }
ol.enumerate { list-style-type: none; background: inherit; }

code.sourceCode > span { display: inline; }
</style>
  <style type="text/css">a {
color : #4183C4;
text-decoration: underline;
}
a.marginalized {
text-decoration: none;
}
a.self-link {
text-decoration: none;
}
h1#toctitle {
border-bottom: 1px solid #cccccc;
}
#TOC li {
margin-top: 1px;
margin-bottom: 1px;
}
#TOC ul>li:before { display: none; }
h3.subtitle { margin-top: -15px; }
h1:target { background-color: transparent; }
h2:target { background-color: transparent; }
h3:target { background-color: transparent; }
h4:target { background-color: transparent; }
h5:target { background-color: transparent; }
h6:target { background-color: transparent; }
code span.co { font-family: monospace; }
table tr {
background-color: white;
}
table tr:nth-child(2n) {
background-color: #f6f8fa;
}
#title-block-header > table tr:nth-child(2n) {
background-color: white;
}
td > div.sourceCode {
background-color: inherit;
}
table {
border-collapse: collapse;
}
table td, table th {
border: 1px solid #cccccc;
}
table th {
border-bottom: 1px solid black;
text-align: center;
}
table tr:first-child th {
border-top: 0;
}
table tr:last-child td {
border-bottom: 0;
}
table tr td:first-child,
table tr th:first-child {
border-left: 0;
}
table tr td:last-child,
table tr th:last-child {
border-right: 0;
}
table tbody tr:first-child td {
border-top: 1px solid black;
}
#title-block-header td { border: 0; }
@media all {
body {
margin: 2em;
}
}
@media screen and (min-width: 480px) {
body {
margin: 5em;
}
}
#refs code{padding-left: 0px; text-indent: 0px;}
:root {
--diff-ins: #e6ffed;
--diff-strongins: #acf2bd;
--diff-del: #ffdddd;
--diff-strongdel: #ff8888;
}
span.diffins {
background-color: var(--diff-strongins);
}
span.diffdel {
background-color: var(--diff-strongdel);
}
div.rm { text-decoration: line-through; }
div.rm code.sourceCode { text-decoration: line-through; }
div.addu, span.addu {
color: #006e28;
background-color: var(--diff-ins);
}

div.rm pre, div.add pre { background-color: #f6f8fa; }
div.addu pre { background-color: var(--diff-ins); }
div.add, div.add pre { background-color: var(--diff-ins); }
div.addu blockquote {
border-left: 4px solid #00a000;
padding: 0 15px;
color: #006e28;
text-decoration: none;
}
div.addu blockquote code.sourceCode { text-decoration: none; }
div.addu blockquote pre { text-decoration: none; }
div.addu blockquote pre code { text-decoration: none; }
div.quote {
border-left: 7px solid #ccc;
background: #f9f9f9;
margin: 1.5em 10px;
padding-left: 20px;
}
code.diff span.va { color: #000000; background-color: var(--diff-ins); }
code.diff span.st { color: #000000; background-color: var(--diff-del); }
</style>
  <link href="data:image/x-icon;base64,AAABAAIAEBAAAAEAIABoBAAAJgAAACAgAAABACAAqBAAAI4EAAAoAAAAEAAAACAAAAABACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////AIJEAACCRAAAgkQAAIJEAACCRAAAgkQAVoJEAN6CRADegkQAWIJEAACCRAAAgkQAAIJEAACCRAAA////AP///wCCRAAAgkQAAIJEAACCRAAsgkQAvoJEAP+CRAD/gkQA/4JEAP+CRADAgkQALoJEAACCRAAAgkQAAP///wD///8AgkQAAIJEABSCRACSgkQA/IJEAP99PQD/dzMA/3czAP99PQD/gkQA/4JEAPyCRACUgkQAFIJEAAD///8A////AHw+AFiBQwDqgkQA/4BBAP9/PxP/uZd6/9rJtf/bybX/upd7/39AFP+AQQD/gkQA/4FDAOqAQgBc////AP///wDKklv4jlEa/3o7AP+PWC//8+3o///////////////////////z7un/kFox/35AAP+GRwD/mVYA+v///wD///8A0Zpk+NmibP+0d0T/8evj///////+/fv/1sKz/9bCs//9/fr//////+/m2/+NRwL/nloA/5xYAPj///8A////ANKaZPjRmGH/5cKh////////////k149/3UwAP91MQD/lmQ//86rhv+USg3/m1YA/5hSAP+bVgD4////AP///wDSmmT4zpJY/+/bx///////8+TV/8mLT/+TVx//gkIA/5lVAP+VTAD/x6B//7aEVv/JpH7/s39J+P///wD///8A0ppk+M6SWP/u2sf///////Pj1f/Nj1T/2KFs/8mOUv+eWhD/lEsA/8aee/+0glT/x6F7/7J8Rvj///8A////ANKaZPjRmGH/48Cf///////+/v7/2qt//82PVP/OkFX/37KJ/86siv+USg7/mVQA/5hRAP+bVgD4////AP///wDSmmT40ppk/9CVXP/69O////////7+/v/x4M//8d/P//7+/f//////9u7n/6tnJf+XUgD/nFgA+P///wD///8A0ppk+NKaZP/RmWL/1qNy//r07///////////////////////+vXw/9akdP/Wnmn/y5FY/6JfFvj///8A////ANKaZFTSmmTo0ppk/9GYYv/Ql1//5cWm//Hg0P/x4ND/5cWm/9GXYP/RmGH/0ppk/9KaZOjVnmpY////AP///wDSmmQA0ppkEtKaZI7SmmT60ppk/9CWX//OkVb/zpFW/9CWX//SmmT/0ppk/NKaZJDSmmQS0ppkAP///wD///8A0ppkANKaZADSmmQA0ppkKtKaZLrSmmT/0ppk/9KaZP/SmmT/0ppkvNKaZCrSmmQA0ppkANKaZAD///8A////ANKaZADSmmQA0ppkANKaZADSmmQA0ppkUtKaZNzSmmTc0ppkVNKaZADSmmQA0ppkANKaZADSmmQA////AP5/AAD4HwAA4AcAAMADAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAMADAADgBwAA+B8AAP5/AAAoAAAAIAAAAEAAAAABACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////AP///wCCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAAyCRACMgkQA6oJEAOqCRACQgkQAEIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAA////AP///wD///8A////AIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRABigkQA5oJEAP+CRAD/gkQA/4JEAP+CRADqgkQAZoJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAAD///8A////AP///wD///8AgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAA4gkQAwoJEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQAxIJEADyCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAP///wD///8A////AP///wCCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAWgkQAmIJEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAJyCRAAYgkQAAIJEAACCRAAAgkQAAIJEAACCRAAA////AP///wD///8A////AIJEAACCRAAAgkQAAIJEAACCRAAAgkQAdIJEAPCCRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAPSCRAB4gkQAAIJEAACCRAAAgkQAAIJEAAD///8A////AP///wD///8AgkQAAIJEAACCRAAAgkQASoJEANKCRAD/gkQA/4JEAP+CRAD/g0YA/39AAP9zLgD/bSQA/2shAP9rIQD/bSQA/3MuAP9/PwD/g0YA/4JEAP+CRAD/gkQA/4JEAP+CRADUgkQAToJEAACCRAAAgkQAAP///wD///8A////AP///wB+PwAAgkUAIoJEAKiCRAD/gkQA/4JEAP+CRAD/hEcA/4BBAP9sIwD/dTAA/5RfKv+viF7/vp56/76ee/+wiF7/lWAr/3YxAP9sIwD/f0AA/4RHAP+CRAD/gkQA/4JEAP+CRAD/gkQArIJEACaBQwAA////AP///wD///8A////AIBCAEBzNAD6f0EA/4NFAP+CRAD/gkQA/4VIAP92MwD/bSUA/6N1Tv/ezsL/////////////////////////////////38/D/6V3Uv9uJgD/dTEA/4VJAP+CRAD/gkQA/4JEAP+BQwD/fUAA/4FDAEj///8A////AP///wD///8AzJRd5qBlKf91NgD/dDUA/4JEAP+FSQD/cy4A/3YyAP/PuKP//////////////////////////////////////////////////////9K7qP94NQD/ciwA/4VJAP+CRAD/fkEA/35BAP+LSwD/mlYA6v///wD///8A////AP///wDdpnL/4qx3/8KJUv+PUhf/cTMA/3AsAP90LgD/4dK+/////////////////////////////////////////////////////////////////+TYxf91MAD/dTIA/31CAP+GRwD/llQA/6FcAP+gWwD8////AP///wD///8A////ANGZY/LSm2X/4ap3/92mcP+wdT3/byQA/8mwj////////////////////////////////////////////////////////////////////////////+LYxv9zLgP/jUoA/59bAP+hXAD/nFgA/5xYAPL///8A////AP///wD///8A0ppk8tKaZP/RmWL/1p9q/9ubXv/XqXj////////////////////////////7+fD/vZyG/6BxS/+gcUr/vJuE//r37f//////////////////////3MOr/5dQBf+dVQD/nVkA/5xYAP+cWAD/nFgA8v///wD///8A////AP///wDSmmTy0ppk/9KaZP/SmWP/yohJ//jo2P//////////////////////4NTG/4JDFf9lGAD/bSQA/20kAP9kGAD/fz8S/+Xb0f//////5NG9/6txN/+LOgD/m1QA/51aAP+cWAD/m1cA/5xYAP+cWADy////AP///wD///8A////ANKaZPLSmmT/0ppk/8+TWf/Unmv//v37//////////////////////+TWRr/VwsA/35AAP+ERgD/g0UA/4JGAP9lHgD/kFga/8KXX/+TRwD/jT4A/49CAP+VTQD/n10A/5xYAP+OQQD/lk4A/55cAPL///8A////AP///wD///8A0ppk8tKaZP/SmmT/y4tO/92yiP//////////////////////8NnE/8eCQP+rcTT/ez0A/3IyAP98PgD/gEMA/5FSAP+USwD/jj8A/5lUAP+JNwD/yqV2/694Mf+HNQD/jkAA/82rf/+laBj/jT4A8v///wD///8A////AP///wDSmmTy0ppk/9KaZP/LiUr/4byY///////////////////////gupX/0I5P/+Wuev/Lklz/l1sj/308AP+QSwD/ol0A/59aAP+aVQD/k0oA/8yoh///////+fXv/6pwO//Lp3v///////Pr4f+oay7y////AP///wD///8A////ANKaZPLSmmT/0ppk/8uJSv/hvJj//////////////////////+G7l//Jhkb/0ppk/96nc//fqXX/x4xO/6dkFP+QSQD/llEA/5xXAP+USgD/yaOA///////38uv/qG05/8ijdv//////8efb/6ZpLPL///8A////AP///wD///8A0ppk8tKaZP/SmmT/zIxO/9yxh///////////////////////7dbA/8iEQf/Sm2X/0Zlj/9ScZv/eqHf/2KJv/7yAQf+XTgD/iToA/5lSAP+JNgD/yKFv/611LP+HNQD/jT8A/8qmeP+kZRT/jT4A8v///wD///8A////AP///wDSmmTy0ppk/9KaZP/Pk1n/1J5q//78+//////////////////+/fv/1aFv/8iEQv/Tm2b/0ppl/9GZY//Wn2z/1pZc/9eldf/Bl2b/kUcA/4w9AP+OQAD/lUwA/59eAP+cWQD/jT8A/5ZOAP+eXADy////AP///wD///8A////ANKaZPLSmmT/0ppk/9KZY//KiEn/8d/P///////////////////////47+f/05tm/8iCP//KiEj/yohJ/8eCP//RmGH//vfy///////n1sP/rXQ7/4k4AP+TTAD/nVoA/5xYAP+cVwD/nFgA/5xYAPL///8A////AP///wD///8A0ppk8tKaZP/SmmT/0ptl/8uLTf/aq37////////////////////////////+/fz/6c2y/961jv/etY7/6Myx//78+v//////////////////////3MWv/5xXD/+ORAD/mFQA/51ZAP+cWAD/nFgA8v///wD///8A////AP///wDSmmTy0ppk/9KaZP/SmmT/0ppk/8mFRP/s1b//////////////////////////////////////////////////////////////////////////////+PD/0JFU/7NzMv+WUQD/kUsA/5tXAP+dWQDy////AP///wD///8A////ANKaZP/SmmT/0ppk/9KaZP/Sm2X/z5NZ/8yMT//z5NX/////////////////////////////////////////////////////////////////9Ofa/8yNUP/UmGH/36p5/8yTWv+qaSD/kksA/5ROAPz///8A////AP///wD///8A0ppk5NKaZP/SmmT/0ppk/9KaZP/TnGf/zY9T/82OUv/t1sD//////////////////////////////////////////////////////+7Yw//OkFX/zI5R/9OcZ//SmmP/26V0/9ymdf/BhUf/ol8R6P///wD///8A////AP///wDSmmQ80ppk9tKaZP/SmmT/0ppk/9KaZP/TnGj/zpFW/8qJSv/dson/8uHS//////////////////////////////////Lj0//etIv/y4lL/86QVf/TnGj/0ppk/9KaZP/RmWP/05xn/9ymdfjUnWdC////AP///wD///8A////ANKaZADSmmQc0ppkotKaZP/SmmT/0ppk/9KaZP/Tm2b/0Zli/8qJSf/NjlH/16Z3/+G8mP/myKr/5siq/+G8mP/Xp3f/zY5S/8qISf/RmGH/05tm/9KaZP/SmmT/0ppk/9KaZP/SmmSm0pljINWdaQD///8A////AP///wD///8A0ppkANKaZADSmmQA0ppkQtKaZMrSmmT/0ppk/9KaZP/SmmT/0ptl/9GYYf/Nj1P/y4lL/8qISP/KiEj/y4lK/82PU//RmGH/0ptl/9KaZP/SmmT/0ppk/9KaZP/SmmTO0ppkRtKaZADSmmQA0ppkAP///wD///8A////AP///wDSmmQA0ppkANKaZADSmmQA0ppkANKaZGzSmmTu0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmTw0ppkcNKaZADSmmQA0ppkANKaZADSmmQA////AP///wD///8A////ANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZBLSmmSQ0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppklNKaZBTSmmQA0ppkANKaZADSmmQA0ppkANKaZAD///8A////AP///wD///8A0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQy0ppkutKaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppkvtKaZDbSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkAP///wD///8A////AP///wDSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkXNKaZODSmmT/0ppk/9KaZP/SmmT/0ppk5NKaZGDSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA////AP///wD///8A////ANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkBtKaZIbSmmTo0ppk6tKaZIrSmmQK0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZAD///8A////AP/8P///+B///+AH//+AAf//AAD//AAAP/AAAA/gAAAHwAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA+AAAAfwAAAP/AAAP/8AAP//gAH//+AH///4H////D//" rel="icon" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  
</head>
<body>
<div class="wrapper">
<header id="title-block-header">
<h1 class="title" style="text-align:center">Superior String Splitting</h1>

<table style="border:none;float:right">
  <tr>
    <td>Document #:</td>
    <td>P2210R1</td>
  </tr>
  <tr>
    <td>Date:</td>
    <td>2021-01-04</td>
  </tr>
  <tr>
    <td style="vertical-align:top">Project:</td>
    <td>Programming Language C++</td>
  </tr>
  <tr>
    <td style="vertical-align:top">Audience:</td>
    <td>
      LEWG<br>
    </td>
  </tr>
  <tr>
    <td style="vertical-align:top">Reply-to:</td>
    <td>
      Barry Revzin<br>&lt;<a href="mailto:barry.revzin@gmail.com" class="email">barry.revzin@gmail.com</a>&gt;<br>
    </td>
  </tr>
</table>

</header>
<div style="clear:both">
<div id="TOC" role="doc-toc">
<h1 id="toctitle">Contents</h1>
<ul>
<li><a href="#revision-history"><span class="toc-section-number">1</span> Revision History<span></span></a></li>
<li><a href="#introduction"><span class="toc-section-number">2</span> Introduction<span></span></a>
<ul>
<li><a href="#can-we-get-there-from-here"><span class="toc-section-number">2.1</span> Can we get there from here<span></span></a></li>
</ul></li>
<li><a href="#design"><span class="toc-section-number">3</span> Design<span></span></a>
<ul>
<li><a href="#what-should-the-reference-type-of-this-be"><span class="toc-section-number">3.1</span> What should the reference type of this be?<span></span></a></li>
<li><a href="#how-would-const-iteration-work"><span class="toc-section-number">3.2</span> How would <code class="sourceCode cpp"><span class="kw">const</span></code> iteration work?<span></span></a></li>
<li><a href="#what-about-input-ranges"><span class="toc-section-number">3.3</span> What about input ranges?<span></span></a></li>
<li><a href="#replace-or-add"><span class="toc-section-number">3.4</span> Replace or Add<span></span></a></li>
</ul></li>
<li><a href="#proposal"><span class="toc-section-number">4</span> Proposal<span></span></a>
<ul>
<li><a href="#implementation"><span class="toc-section-number">4.1</span> Implementation<span></span></a></li>
</ul></li>
<li><a href="#wording"><span class="toc-section-number">5</span> Wording<span></span></a>
<ul>
<li><a href="#wording-for-split---lazy_split"><span class="toc-section-number">5.1</span> Wording for <code class="sourceCode cpp">split</code> -&gt; <code class="sourceCode cpp">lazy_split</code><span></span></a></li>
<li><a href="#wording-for-new-split"><span class="toc-section-number">5.2</span> Wording for new <code class="sourceCode cpp">split</code><span></span></a>
<ul>
<li><a href="#overview-range.split2.overview"><span class="toc-section-number">5.2.1</span> Overview [range.split2.overview]<span></span></a></li>
<li><a href="#class-template-split_view-range.split2.view"><span class="toc-section-number">5.2.2</span> Class template <code class="sourceCode cpp">split_view</code> [range.split2.view]<span></span></a></li>
<li><a href="#class-template-split_view_iterator_-range.split2.iterator"><span class="toc-section-number">5.2.3</span> Class template <code class="sourceCode cpp">split_view​<span class="op">::</span><em>​iterator</em></code> [range.split2.iterator]<span></span></a></li>
<li><a href="#class-template-split_view_sentinel_-range.split2.sentinel"><span class="toc-section-number">5.2.4</span> Class template <code class="sourceCode cpp">split_view​<span class="op">::</span><em>​sentinel</em></code> [range.split2.sentinel]<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="#bibliography"><span class="toc-section-number">6</span> References<span></span></a></li>
</ul>
</div>
<h1 data-number="1" style="border-bottom:1px solid #cccccc" id="revision-history"><span class="header-section-number">1</span> Revision History<a href="#revision-history" class="self-link"></a></h1>
<p>Since <span class="citation" data-cites="P2210R0">[<a href="#ref-P2210R0" role="doc-biblioref">P2210R0</a>]</span>, corrected the explanation of <code class="sourceCode cpp"><span class="kw">const</span></code>-iteration and corrected that it is sort of possible to build a better <code class="sourceCode cpp">split</code> on top of the existing one. Changed the proposal to keep the preexisting <code class="sourceCode cpp">split</code> with its semantics under a different name instead.</p>
<h1 data-number="2" style="border-bottom:1px solid #cccccc" id="introduction"><span class="header-section-number">2</span> Introduction<a href="#introduction" class="self-link"></a></h1>
<p>Let’s say you have a string like <code class="sourceCode cpp"><span class="st">&quot;1.2.3.4&quot;</span></code> and you want it turn it into a range of integers. You might expect to be able to write:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1"></a>std<span class="op">::</span>string s <span class="op">=</span> <span class="st">&quot;1.2.3.4&quot;</span>;</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">auto</span> ints <span class="op">=</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>    s <span class="op">|</span> views<span class="op">::</span>split<span class="op">(</span><span class="ch">&#39;.&#39;</span><span class="op">)</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>      <span class="op">|</span> views<span class="op">::</span>transform<span class="op">([](</span><span class="kw">auto</span> v<span class="op">){</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>            <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span>;</span>
<span id="cb1-7"><a href="#cb1-7"></a>            std<span class="op">::</span>from_chars<span class="op">(</span>v<span class="op">.</span>data<span class="op">()</span>, v<span class="op">.</span>size<span class="op">()</span>, <span class="op">&amp;</span>i<span class="op">)</span>;</span>
<span id="cb1-8"><a href="#cb1-8"></a>            <span class="cf">return</span> i;</span>
<span id="cb1-9"><a href="#cb1-9"></a>        <span class="op">})</span></span></code></pre></div>
<p>But that doesn’t work. Nor does this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1"></a>std<span class="op">::</span>string s <span class="op">=</span> <span class="st">&quot;1.2.3.4&quot;</span>;</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">auto</span> ints <span class="op">=</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>    s <span class="op">|</span> views<span class="op">::</span>split<span class="op">(</span><span class="ch">&#39;.&#39;</span><span class="op">)</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>      <span class="op">|</span> views<span class="op">::</span>transform<span class="op">([](</span><span class="kw">auto</span> v<span class="op">){</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>          <span class="cf">return</span> std<span class="op">::</span>stoi<span class="op">(</span>std<span class="op">::</span>string<span class="op">(</span>v<span class="op">.</span>begin<span class="op">()</span>, v<span class="op">.</span>end<span class="op">()))</span>;</span>
<span id="cb2-7"><a href="#cb2-7"></a>        <span class="op">})</span>;</span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="op">}</span></span></code></pre></div>
<p>although for a different reason.</p>
<p>The problem ultimately is that splitting a <code class="sourceCode cpp">string</code> using C++20’s <code class="sourceCode cpp">views<span class="op">::</span>split</code> gives you a range that is <em>only</em> a forward range. Even though the source range is contiguous! And that forward range isn’t a common range either. As a result, can’t use <code class="sourceCode cpp">from_chars</code> (it needs a pointer) and can’t construct a <code class="sourceCode cpp">std<span class="op">::</span>string</code> (its range constructor takes an iterator pair, not iterator/sentinel).</p>
<h2 data-number="2.1" id="can-we-get-there-from-here"><span class="header-section-number">2.1</span> Can we get there from here<a href="#can-we-get-there-from-here" class="self-link"></a></h2>
<p>The reason it’s like this is that <code class="sourceCode cpp">views<span class="op">::</span>split</code> is maximally lazy. It kind of needs to be in order to support splitting an input range. But the intent of laziness is that you can build more eager algorithms on top of them. We can sort of do that with this one:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1"></a>std<span class="op">::</span>string input <span class="op">=</span> <span class="st">&quot;1.2.3.4&quot;</span>;</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">auto</span> parts <span class="op">=</span> input <span class="op">|</span> views<span class="op">::</span>split<span class="op">(</span><span class="ch">&#39;.&#39;</span><span class="op">)</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>                   <span class="op">|</span> views<span class="op">::</span>transform<span class="op">([](</span><span class="kw">auto</span> r<span class="op">){</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>                        <span class="kw">auto</span> b <span class="op">=</span> r<span class="op">.</span>begin<span class="op">()</span>;</span>
<span id="cb3-5"><a href="#cb3-5"></a>                        <span class="kw">auto</span> e <span class="op">=</span> ranges<span class="op">::</span>next<span class="op">(</span>b, r<span class="op">.</span>end<span class="op">())</span>;</span>
<span id="cb3-6"><a href="#cb3-6"></a>                        <span class="cf">return</span> ranges<span class="op">::</span>subrange<span class="op">(</span>b<span class="op">.</span>base<span class="op">()</span>, e<span class="op">.</span>base<span class="op">())</span>;</span>
<span id="cb3-7"><a href="#cb3-7"></a>                     <span class="op">})</span>;</span></code></pre></div>
<p>This implementation requires <code class="sourceCode cpp">b<span class="op">.</span>base<span class="op">()</span></code> (<code class="sourceCode cpp">split_view</code>’s iterators do not provide such a thing at the moment), but once we add that, this solution provides the right overall shape that we need. The individual elements of <code class="sourceCode cpp">parts</code> here are contiguous views, which will have a <code class="sourceCode cpp">data<span class="op">()</span></code> member function that can be passed to <code class="sourceCode cpp">std<span class="op">::</span>from_chars</code>.</p>
<p>Given the range adapter closure functionality, we could just stash this somewhere:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> Pattern<span class="op">&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">auto</span> split2<span class="op">(</span>Pattern pattern<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="cf">return</span> views<span class="op">::</span>split<span class="op">(</span>std<span class="op">::</span>move<span class="op">(</span>pattern<span class="op">))</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>         <span class="op">|</span> views<span class="op">::</span>transform<span class="op">([](</span><span class="kw">auto</span> r<span class="op">){</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>              <span class="kw">auto</span> b <span class="op">=</span> r<span class="op">.</span>begin<span class="op">()</span>;</span>
<span id="cb4-6"><a href="#cb4-6"></a>              <span class="kw">auto</span> e <span class="op">=</span> ranges<span class="op">::</span>next<span class="op">(</span>b, r<span class="op">.</span>end<span class="op">())</span>;</span>
<span id="cb4-7"><a href="#cb4-7"></a>              <span class="cf">return</span> ranges<span class="op">::</span>subrange<span class="op">(</span>b<span class="op">.</span>base<span class="op">()</span>, e<span class="op">.</span>base<span class="op">())</span>;</span>
<span id="cb4-8"><a href="#cb4-8"></a>           <span class="op">})</span>;    </span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="op">}</span></span>
<span id="cb4-10"><a href="#cb4-10"></a></span>
<span id="cb4-11"><a href="#cb4-11"></a>std<span class="op">::</span>string input <span class="op">=</span> <span class="st">&quot;1.2.3.4&quot;</span>;</span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="kw">auto</span> parts <span class="op">=</span> input <span class="op">|</span> split2<span class="op">(</span><span class="ch">&#39;.&#39;</span><span class="op">)</span>;</span></code></pre></div>
<p>Is this good enough?</p>
<p>It’s better, but there’s some downsides with this. First, the above fares pretty badly with input iterators - since we’ve already consumed the whole range before even providing it to the user. If they touch the range in any way, it’s undefined behavior. The narrowest possible contract?</p>
<p>We can fix that:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> Pattern<span class="op">&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw">auto</span> split2<span class="op">(</span>Pattern pattern<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="cf">return</span> views<span class="op">::</span>split<span class="op">(</span><span class="ch">&#39;.&#39;</span><span class="op">)</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>         <span class="op">|</span> views<span class="op">::</span>transform<span class="op">([](</span><span class="kw">auto</span> r<span class="op">){</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>                <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>ranges<span class="op">::</span>forward_range<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>r<span class="op">)&gt;)</span> <span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>                    <span class="kw">auto</span> b <span class="op">=</span> r<span class="op">.</span>begin<span class="op">()</span>;</span>
<span id="cb5-7"><a href="#cb5-7"></a>                    <span class="kw">auto</span> e <span class="op">=</span> ranges<span class="op">::</span>next<span class="op">(</span>b, r<span class="op">.</span>end<span class="op">())</span>;</span>
<span id="cb5-8"><a href="#cb5-8"></a>                    <span class="cf">return</span> ranges<span class="op">::</span>subrange<span class="op">(</span>b<span class="op">.</span>base<span class="op">()</span>, e<span class="op">.</span>base<span class="op">())</span>;</span>
<span id="cb5-9"><a href="#cb5-9"></a>                <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>                    <span class="cf">return</span> r;</span>
<span id="cb5-11"><a href="#cb5-11"></a>                <span class="op">}</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>           <span class="op">})</span>;    </span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="op">}</span></span></code></pre></div>
<p>Now we properly handle input ranges as well, although we can’t really avoid the extra completely-pointless <code class="sourceCode cpp">transform</code> without writing a proper range adapter closure ourselves.</p>
<p>Second, this has the problem that every iterator dereference from the resulting view has to do a linear search. That’s a cost that’s incurred entirely due to this implementation strategy. This cost could be alleviated by using <span class="citation" data-cites="P2214R0">[<a href="#ref-P2214R0" role="doc-biblioref">P2214R0</a>]</span>’s suggested <code class="sourceCode cpp">views<span class="op">::</span>cache_latest</code>, though this itself has the problem that it demotes the resulting range to input-only… whereas a <code class="sourceCode cpp">split_view</code> could be a forward range.</p>
<p>Third, this is complicated! There are two important points here:</p>
<ol type="1">
<li><code class="sourceCode cpp">split</code> is overwhelmingly likely to be used on, specifically, a contiguous range of characters.</li>
<li><code class="sourceCode cpp">split</code>ting a <code class="sourceCode cpp">string</code> is a common operation to want to do.</li>
</ol>
<p>While I’ve <code class="sourceCode cpp">transform</code>ed and <code class="sourceCode cpp">filter</code>ed all sorts of other kinds of ranges, and have appreciated the work that went into making them as flexible as they are, I’ve really never wanted to split anything other than a <code class="sourceCode cpp">string</code> (or a <code class="sourceCode cpp">string_view</code> or other equivalent types). But for the most common use case of a fairly common operation, the <code class="sourceCode cpp">views<span class="op">::</span>split</code> that we have ends up falling short because of what it gives us: a forward range. Pretty much every interesting string algorithm requires more than that:</p>
<ul>
<li>The aforementioned <code class="sourceCode cpp">std<span class="op">::</span>from_chars</code> requires a contiguous range (really, specifically, a <code class="sourceCode cpp"><span class="dt">char</span> <span class="kw">const</span><span class="op">*</span></code> and a length)</li>
<li><code class="sourceCode cpp">std<span class="op">::</span>regex</code> and <code class="sourceCode cpp">boost<span class="op">::</span>regex</code> both require a bidirectional range.</li>
<li>Many text and unicode algorithms require a bidirectional range.</li>
</ul>
<p>It would be great if <code class="sourceCode cpp">views<span class="op">::</span>split</code> could work in such a way that the result was maximally usable - which in this case means that splitting a contiguous range should provide contiguous sub-ranges.</p>
<h1 data-number="3" style="border-bottom:1px solid #cccccc" id="design"><span class="header-section-number">3</span> Design<a href="#design" class="self-link"></a></h1>
<p>I wrote a blog on this topic <span class="citation" data-cites="revzin.split">[<a href="#ref-revzin.split" role="doc-biblioref">revzin.split</a>]</span>, which implements a version of <code class="sourceCode cpp">split_view</code> that operates on contiguous ranges (and naughtily partially specializes <code class="sourceCode cpp">std<span class="op">::</span>ranges<span class="op">::</span>split_view</code>) such that the following actually works:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">auto</span> ip <span class="op">=</span> <span class="st">&quot;127.0.0.1&quot;</span><span class="bu">s</span>;</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">auto</span> parts <span class="op">=</span> ip <span class="op">|</span> std<span class="op">::</span>views<span class="op">::</span>split<span class="op">(</span><span class="ch">&#39;.&#39;</span><span class="op">)</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>                <span class="op">|</span> std<span class="op">::</span>views<span class="op">::</span>transform<span class="op">([](</span>std<span class="op">::</span>span<span class="op">&lt;</span><span class="dt">char</span> <span class="kw">const</span><span class="op">&gt;</span> s<span class="op">){</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>                      <span class="dt">int</span> i;</span>
<span id="cb6-5"><a href="#cb6-5"></a>                      std<span class="op">::</span>from_chars<span class="op">(</span>s<span class="op">.</span>data<span class="op">()</span>, s<span class="op">.</span>data<span class="op">()</span> <span class="op">+</span> s<span class="op">.</span>size<span class="op">()</span>, i<span class="op">)</span>;</span>
<span id="cb6-6"><a href="#cb6-6"></a>                      <span class="cf">return</span> i;</span>
<span id="cb6-7"><a href="#cb6-7"></a>                  <span class="op">})</span>;</span>
<span id="cb6-8"><a href="#cb6-8"></a></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="kw">struct</span> zstring_sentinel <span class="op">{</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>    <span class="dt">bool</span> <span class="kw">operator</span><span class="op">==(</span><span class="dt">char</span> <span class="kw">const</span><span class="op">*</span> p<span class="op">)</span> <span class="kw">const</span> <span class="op">{</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>        <span class="cf">return</span> <span class="op">*</span>p <span class="op">==</span> <span class="ch">&#39;</span><span class="sc">\0</span><span class="ch">&#39;</span>;</span>
<span id="cb6-12"><a href="#cb6-12"></a>    <span class="op">}</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="op">}</span>;</span>
<span id="cb6-14"><a href="#cb6-14"></a></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="kw">struct</span> zstring <span class="op">:</span> view_interface<span class="op">&lt;</span>zstring<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb6-16"><a href="#cb6-16"></a>    <span class="dt">char</span> <span class="kw">const</span><span class="op">*</span> p <span class="op">=</span> <span class="kw">nullptr</span>;</span>
<span id="cb6-17"><a href="#cb6-17"></a>    zstring<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span>;</span>
<span id="cb6-18"><a href="#cb6-18"></a>    zstring<span class="op">(</span><span class="dt">char</span> <span class="kw">const</span><span class="op">*</span> p<span class="op">)</span> <span class="op">:</span> p<span class="op">(</span>p<span class="op">)</span> <span class="op">{</span> <span class="op">}</span></span>
<span id="cb6-19"><a href="#cb6-19"></a>    <span class="kw">auto</span> begin<span class="op">()</span> <span class="kw">const</span> <span class="op">{</span> <span class="cf">return</span> p; <span class="op">}</span></span>
<span id="cb6-20"><a href="#cb6-20"></a>    <span class="kw">auto</span> end<span class="op">()</span> <span class="kw">const</span> <span class="op">{</span> <span class="cf">return</span> zstring_sentinel<span class="op">{}</span>; <span class="op">}</span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="op">}</span>;</span>
<span id="cb6-22"><a href="#cb6-22"></a></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="dt">char</span> <span class="kw">const</span><span class="op">*</span> words <span class="op">=</span> <span class="st">&quot;A quick brown fox&quot;</span>;</span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="cf">for</span> <span class="op">(</span>std<span class="op">::</span>span ss <span class="op">:</span> zstring<span class="op">{</span>words<span class="op">}</span> <span class="op">|</span> std<span class="op">::</span>views<span class="op">::</span>split<span class="op">(</span><span class="ch">&#39; &#39;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb6-25"><a href="#cb6-25"></a>    <span class="kw">auto</span> sv <span class="op">=</span> std<span class="op">::</span>string_view<span class="op">(</span>ss<span class="op">.</span>data<span class="op">()</span>, ss<span class="op">.</span>size<span class="op">())</span>;</span>
<span id="cb6-26"><a href="#cb6-26"></a>    std<span class="op">::</span>cout <span class="op">&lt;&lt;</span> sv <span class="op">&lt;&lt;</span> <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span>;</span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="op">}</span></span></code></pre></div>
<p>There are a few big questions to be resolved here:</p>
<h2 data-number="3.1" id="what-should-the-reference-type-of-this-be"><span class="header-section-number">3.1</span> What should the reference type of this be?<a href="#what-should-the-reference-type-of-this-be" class="self-link"></a></h2>
<p>Given a range <code class="sourceCode cpp">V</code>, the reference type of <code class="sourceCode cpp">split_view<span class="op">&lt;</span>V<span class="op">&gt;</span></code> should be <code class="sourceCode cpp">subrange<span class="op">&lt;</span>iterator_t<span class="op">&lt;</span>V<span class="op">&gt;&gt;</span></code>. This is a generic solution, that works well for all range categories (as long as they’re forward-or-better).</p>
<p>For splitting a <code class="sourceCode cpp">string</code>, this means we get a range of <code class="sourceCode cpp">subrange<span class="op">&lt;</span>string<span class="op">::</span>iterator<span class="op">&gt;</span></code> where we might wish we got a <code class="sourceCode cpp">span<span class="op">&lt;</span><span class="dt">char</span> <span class="kw">const</span><span class="op">&gt;</span></code> or a <code class="sourceCode cpp">string_view</code>, but <code class="sourceCode cpp">span<span class="op">&lt;</span><span class="dt">char</span> <span class="kw">const</span><span class="op">&gt;</span></code> is already constructible from <code class="sourceCode cpp">subrange<span class="op">&lt;</span>string<span class="op">::</span>iterator<span class="op">&gt;</span></code> and <code class="sourceCode cpp">string_view</code> would be with the adoption of <span class="citation" data-cites="P1989R0">[<a href="#ref-P1989R0" role="doc-biblioref">P1989R0</a>]</span>.</p>
<p>We could additionally favor the <code class="sourceCode cpp"><span class="dt">char</span></code> case (since, again, splitting <code class="sourceCode cpp">string</code>s is the overwhemlingly common case) by doing something like:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">struct</span> reference <span class="op">:</span> subrange<span class="op">&lt;</span>iterator_t<span class="op">&lt;</span>V<span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>    <span class="kw">using</span> subrange<span class="op">::</span>subrange;</span>
<span id="cb7-3"><a href="#cb7-3"></a>    </span>
<span id="cb7-4"><a href="#cb7-4"></a>    <span class="kw">operator</span> string_view<span class="op">()</span> <span class="kw">const</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>        <span class="kw">requires</span> same_as<span class="op">&lt;</span>range_value_t<span class="op">&lt;</span>V<span class="op">&gt;</span>, <span class="dt">char</span><span class="op">&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>              <span class="op">&amp;&amp;</span> contiguous_range<span class="op">&lt;</span>V<span class="op">&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>    <span class="op">{</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>        <span class="cf">return</span> <span class="op">{</span><span class="kw">this</span><span class="op">-&gt;</span>data<span class="op">()</span>, <span class="kw">this</span><span class="op">-&gt;</span>size<span class="op">()}</span>;</span>
<span id="cb7-9"><a href="#cb7-9"></a>    <span class="op">}</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="op">}</span>;</span></code></pre></div>
<p>But this just seems weirdly specific and not a good idea.</p>
<h2 data-number="3.2" id="how-would-const-iteration-work"><span class="header-section-number">3.2</span> How would <code class="sourceCode cpp"><span class="kw">const</span></code> iteration work?<a href="#how-would-const-iteration-work" class="self-link"></a></h2>
<p>We say that a type, <code class="sourceCode cpp">R</code>, is <code class="sourceCode cpp"><span class="kw">const</span></code>-iterable if <code class="sourceCode cpp">R <span class="kw">const</span></code> is also a range. This comes into play if you want to write something like:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">// parts is &#39;const&#39;</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw">auto</span> <span class="kw">const</span> parts <span class="op">=</span> rng <span class="op">|</span> views<span class="op">::</span>split<span class="op">(</span>pat<span class="op">)</span>;</span></code></pre></div>
<p>Or pass this adapted range into a function template that looks like this:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> R<span class="op">&gt;</span> <span class="dt">void</span> some_algo<span class="op">(</span>R <span class="kw">const</span><span class="op">&amp;)</span>;</span></code></pre></div>
<p>Several range adapters in the standard library today are <em>not</em> <code class="sourceCode cpp"><span class="kw">const</span></code>-iterable (such as <code class="sourceCode cpp">filter_view</code> and its similar cousin <code class="sourceCode cpp">drop_while_view</code>). See also <span class="citation" data-cites="issue385">[<a href="#ref-issue385" role="doc-biblioref">issue385</a>]</span>.</p>
<p>The big issue for moving forward with <code class="sourceCode cpp">std<span class="op">::</span>ranges<span class="op">::</span>split_view</code> is how to square some constraints:</p>
<ol type="1">
<li><code class="sourceCode cpp">begin<span class="op">()</span></code> must be amortized constant time to model <code class="sourceCode cpp">range</code></li>
<li>Member functions that are marked <code class="sourceCode cpp"><span class="kw">const</span></code> in the standard library cannot introduce data results (see <span>16.4.6.10
 <a href="https://wg21.link/res.on.data.races">[res.on.data.races]</a></span>).</li>
<li>The existing <code class="sourceCode cpp">split_view</code> is <code class="sourceCode cpp"><span class="kw">const</span></code>-iterable.</li>
</ol>
<p>So how do we get the first piece? What I did as part of my implementation was to not allow <code class="sourceCode cpp"><span class="kw">const</span></code>-iteration. <code class="sourceCode cpp">split_view</code> just has an <code class="sourceCode cpp">optional<span class="op">&lt;</span>iterator<span class="op">&gt;</span></code> member which is populated the first time you call <code class="sourceCode cpp">begin</code> and then is just returned thereafter. This is similar to other views that need to do arbitrary work to yield the first element (canonically, <code class="sourceCode cpp">filter_view</code>).</p>
<p>You can’t do this in a <code class="sourceCode cpp"><span class="kw">const</span></code> member function. We cannot simply specify the <code class="sourceCode cpp">optional<span class="op">&lt;</span>iterator<span class="op">&gt;</span></code> member as <code class="sourceCode cpp"><span class="kw">mutable</span></code>, since two threads couldn’t safely update it concurrently. We <em>could</em> introduce a synchronization mechanism into <code class="sourceCode cpp">split_view</code> which would safely allow such concurrent modification, but that’s a very expensive solution which would also pessimize the typical non-const-iteration case. So we <em>shouldn’t</em>.</p>
<p>So that’s okay, we just don’t support <code class="sourceCode cpp"><span class="kw">const</span></code>-iteration. What’s the big deal?</p>
<p>Well, as I noted, the <em>existing</em> <code class="sourceCode cpp">split_view</code> <em>is</em> <code class="sourceCode cpp"><span class="kw">const</span></code>-iterable - because it’s lazy! It doesn’t yield <code class="sourceCode cpp">subrange</code>s, it yields a lazy range. So it doesn’t actually need to do work in <code class="sourceCode cpp">begin<span class="op">()</span></code> - this is a non-issue.</p>
<p>On the other hand, any kind of implementation that eagerly produces <code class="sourceCode cpp">subrange</code>s for splitting a <code class="sourceCode cpp">string <span class="kw">const</span></code> necessarily has to do work to get that first <code class="sourceCode cpp">subrange</code> and that ends up being a clash with the existing design.</p>
<p>The question is - how much code currently exists that iterates over, specifically, a <code class="sourceCode cpp"><span class="kw">const</span> split_view</code> that is splitting a contiguous range? It’s likely to be exceedingly small, both because of the likelihood if such iteration to begin with (you’d have to <em>specifically</em> declare an object of type <code class="sourceCode cpp">split_view</code> as being <code class="sourceCode cpp"><span class="kw">const</span></code>) and the existing usability issues described in this paper.</p>
<p>Plus, at this point, only libstdc++ ships <code class="sourceCode cpp">split_view</code>. And even then, it implements the spec to the letter, which means there are at least two issues with it: broken support of long patterns <span class="citation" data-cites="LWG3505">[<a href="#ref-LWG3505" role="doc-biblioref">LWG3505</a>]</span> and trailing patterns <span class="citation" data-cites="LWG3478">[<a href="#ref-LWG3478" role="doc-biblioref">LWG3478</a>]</span>. So even if somebody is depending on existing behavior, they probably shouldn’t.</p>
<p>Personally, I think the trade-off is hugely in favor of making this change - it makes <code class="sourceCode cpp">split</code> substantially more useful.</p>
<h2 data-number="3.3" id="what-about-input-ranges"><span class="header-section-number">3.3</span> What about input ranges?<a href="#what-about-input-ranges" class="self-link"></a></h2>
<p>This strategy of producing a range of <code class="sourceCode cpp">subrange<span class="op">&lt;</span>iterator_t<span class="op">&lt;</span>V<span class="op">&gt;&gt;</span></code> works fine for forward ranges, and is a significant improvement over status quo for bidirectional, random access, and contiguous ranges.</p>
<p>But it fails miserably for input ranges, which the current <code class="sourceCode cpp">views<span class="op">::</span>split</code> supports. While <code class="sourceCode cpp"><span class="kw">const</span></code>-iteration doesn’t strike me as important functionality, being able to <code class="sourceCode cpp">split</code> an input range definitely does.</p>
<p>A <code class="sourceCode cpp">subrange</code>-yielding split could still fall back to the existing <code class="sourceCode cpp">views<span class="op">::</span>split</code> behavior for splitting input ranges, but then we end up with fairly different semantics for splitting input ranges and splitting forward-or-better ranges. But we also don’t want to <em>not</em> support splitting input ranges.</p>
<p>This leads us to the big question…</p>
<h2 data-number="3.4" id="replace-or-add"><span class="header-section-number">3.4</span> Replace or Add<a href="#replace-or-add" class="self-link"></a></h2>
<p>Do we <em>replace</em> the existing <code class="sourceCode cpp">views<span class="op">::</span>split</code> with the one outlined in this paper, or do we add a new one?</p>
<p>The only way to really replace is if we have the one-view-two-semantics implementation described in the previous section: for forward-or-better, the view produces <code class="sourceCode cpp">subrange</code>s, while for input, it produces a lazy-searching range. This just doesn’t seem great from a design perspective. And if we <em>don’t</em> do that, then the only way we can replace is by dropping input range support entirely. Which doesn’t seem great from a user perspective since we lose functionality. Granted, we gain the ability to actually split strings well, which is drastically more important than splitting input ranges, but still.</p>
<p>The alternative is to add a new kind of <code class="sourceCode cpp">views<span class="op">::</span>split</code> that only supports splitting forward-or-better ranges. We could adopt such a new view under a different name (<code class="sourceCode cpp">views<span class="op">::</span>split2</code> is the obvious choice, but <code class="sourceCode cpp">std2<span class="op">::</span>split</code> is even better), but I think it would be better to give the good name to the more broadly useful facility.</p>
<p>That is, provide a new <code class="sourceCode cpp">views<span class="op">::</span>split</code> that produces <code class="sourceCode cpp">subrange</code>s and rename the existing facility to <code class="sourceCode cpp">views<span class="op">::</span>lazy_split</code>. This isn’t a great name, since <code class="sourceCode cpp">views<span class="op">::</span>split</code> is <em>also</em> a lazy split, but it’s the best I’ve got at the moment.</p>
<p>Note that, as described earlier, <code class="sourceCode cpp">views<span class="op">::</span>split</code> should not be specified (or implemented) in terms of <code class="sourceCode cpp">views<span class="op">::</span>lazy_split</code>, since a proper implementation of it could be much more efficient.</p>
<h1 data-number="4" style="border-bottom:1px solid #cccccc" id="proposal"><span class="header-section-number">4</span> Proposal<a href="#proposal" class="self-link"></a></h1>
<p>This paper proposes the following:</p>
<ol type="1">
<li><p>Rename the existing <code class="sourceCode cpp">views<span class="op">::</span>split</code> / <code class="sourceCode cpp">ranges<span class="op">::</span>split_view</code> to <code class="sourceCode cpp">views<span class="op">::</span>lazy_split</code> / <code class="sourceCode cpp">ranges<span class="op">::</span>lazy_split_view</code>. Add <code class="sourceCode cpp">base<span class="op">()</span></code> member functions to the <em><code class="sourceCode cpp">inner<span class="op">-</span>iterator</code></em> type to get back to the adapted range’s iterators.</p></li>
<li><p>Introduce a new range adapter under the name <code class="sourceCode cpp">views<span class="op">::</span>split</code> / <code class="sourceCode cpp">ranges<span class="op">::</span>split_view</code> with the following design:</p>
<ol type="a">
<li>It can only support splitting forward-or-better ranges.</li>
<li>Splitting a <code class="sourceCode cpp">V</code> will yield <code class="sourceCode cpp">subrange<span class="op">&lt;</span>iterator_t<span class="op">&lt;</span>V<span class="op">&gt;&gt;</span></code>s, ensuring that the adapted range’s category is preserved. Splitting a bidirectional range gives out bidirectional subranges. Spltiting a contiguous range gives out contiguous subranges.</li>
<li><code class="sourceCode cpp">views<span class="op">::</span>split</code> will not be <code class="sourceCode cpp"><span class="kw">const</span></code>-iterable.</li>
</ol></li>
</ol>
<p>This could certainly break some C++20 code. But I would argue that <code class="sourceCode cpp">views<span class="op">::</span>split</code> is so unergonomic for its most common intended use-case that the benefit of making it actually usable for that case far outweighs the cost of potentially breaking some code (which itself is likely to be small given both the usability issues and lack of implementations thus far).</p>
<h2 data-number="4.1" id="implementation"><span class="header-section-number">4.1</span> Implementation<a href="#implementation" class="self-link"></a></h2>
<p>The implementation can be found in action here <span class="citation" data-cites="revzin.split.impl">[<a href="#ref-revzin.split.impl" role="doc-biblioref">revzin.split.impl</a>]</span>, but reproduced here for clarity.</p>
<p>This implementation does the weird <code class="sourceCode cpp"><span class="kw">operator</span> string_view<span class="op">()</span> <span class="kw">const</span></code> hack described earlier as a workaround for the lack of <span class="citation" data-cites="P1989R0">[<a href="#ref-P1989R0" role="doc-biblioref">P1989R0</a>]</span>, and currently just hijacks the real <code class="sourceCode cpp">views<span class="op">::</span>split</code> as a shortcut, but other than that it should be a valid implementation.</p>
<p>This implementation also correctly handles <span class="citation" data-cites="LWG3505">[<a href="#ref-LWG3505" role="doc-biblioref">LWG3505</a>]</span> and <span class="citation" data-cites="LWG3478">[<a href="#ref-LWG3478" role="doc-biblioref">LWG3478</a>]</span>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">::</span>ranges;</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="kw">template</span> <span class="op">&lt;</span>forward_range V, forward_range Pattern<span class="op">&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>    <span class="kw">requires</span> view<span class="op">&lt;</span>V<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> view<span class="op">&lt;</span>Pattern<span class="op">&gt;</span> <span class="op">&amp;&amp;</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>    std<span class="op">::</span>indirectly_comparable<span class="op">&lt;</span>iterator_t<span class="op">&lt;</span>V<span class="op">&gt;</span>,</span>
<span id="cb10-6"><a href="#cb10-6"></a>                               iterator_t<span class="op">&lt;</span>Pattern<span class="op">&gt;</span>,</span>
<span id="cb10-7"><a href="#cb10-7"></a>                               equal_to<span class="op">&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="kw">class</span> split2_view</span>
<span id="cb10-9"><a href="#cb10-9"></a>    <span class="op">:</span> <span class="kw">public</span> view_interface<span class="op">&lt;</span>split2_view<span class="op">&lt;</span>V, Pattern<span class="op">&gt;&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="op">{</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>    split2_view<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span>;</span>
<span id="cb10-13"><a href="#cb10-13"></a>    split2_view<span class="op">(</span>V base, Pattern pattern<span class="op">)</span></span>
<span id="cb10-14"><a href="#cb10-14"></a>        <span class="op">:</span> base_<span class="op">(</span>base<span class="op">)</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>        , pattern_<span class="op">(</span>pattern<span class="op">)</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>    <span class="op">{</span> <span class="op">}</span></span>
<span id="cb10-17"><a href="#cb10-17"></a></span>
<span id="cb10-18"><a href="#cb10-18"></a>    <span class="kw">template</span> <span class="op">&lt;</span>forward_range R<span class="op">&gt;</span></span>
<span id="cb10-19"><a href="#cb10-19"></a>        <span class="kw">requires</span> std<span class="op">::</span>constructible_from<span class="op">&lt;</span>V, views<span class="op">::</span>all_t<span class="op">&lt;</span>R<span class="op">&gt;&gt;</span></span>
<span id="cb10-20"><a href="#cb10-20"></a>            <span class="op">&amp;&amp;</span> std<span class="op">::</span>constructible_from<span class="op">&lt;</span>Pattern, single_view<span class="op">&lt;</span>range_value_t<span class="op">&lt;</span>R<span class="op">&gt;&gt;&gt;</span></span>
<span id="cb10-21"><a href="#cb10-21"></a>    split2_view<span class="op">(</span>R<span class="op">&amp;&amp;</span> r, range_value_t<span class="op">&lt;</span>R<span class="op">&gt;</span> elem<span class="op">)</span></span>
<span id="cb10-22"><a href="#cb10-22"></a>        <span class="op">:</span> base_<span class="op">(</span>std<span class="op">::</span>views<span class="op">::</span>all<span class="op">(</span>std<span class="op">::</span>forward<span class="op">&lt;</span>R<span class="op">&gt;(</span>r<span class="op">)))</span></span>
<span id="cb10-23"><a href="#cb10-23"></a>        , pattern_<span class="op">(</span>std<span class="op">::</span>move<span class="op">(</span>elem<span class="op">))</span></span>
<span id="cb10-24"><a href="#cb10-24"></a>    <span class="op">{</span> <span class="op">}</span></span>
<span id="cb10-25"><a href="#cb10-25"></a></span>
<span id="cb10-26"><a href="#cb10-26"></a>    <span class="kw">struct</span> sentinel;</span>
<span id="cb10-27"><a href="#cb10-27"></a>    <span class="kw">struct</span> as_sentinel_t <span class="op">{</span> <span class="op">}</span>;</span>
<span id="cb10-28"><a href="#cb10-28"></a></span>
<span id="cb10-29"><a href="#cb10-29"></a>    <span class="kw">class</span> iterator <span class="op">{</span></span>
<span id="cb10-30"><a href="#cb10-30"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb10-31"><a href="#cb10-31"></a>        <span class="kw">friend</span> sentinel;</span>
<span id="cb10-32"><a href="#cb10-32"></a></span>
<span id="cb10-33"><a href="#cb10-33"></a>        split2_view<span class="op">*</span> parent <span class="op">=</span> <span class="kw">nullptr</span>;</span>
<span id="cb10-34"><a href="#cb10-34"></a>        iterator_t<span class="op">&lt;</span>V<span class="op">&gt;</span> cur <span class="op">=</span> iterator_t<span class="op">&lt;</span>V<span class="op">&gt;()</span>;</span>
<span id="cb10-35"><a href="#cb10-35"></a>        iterator_t<span class="op">&lt;</span>V<span class="op">&gt;</span> next <span class="op">=</span> iterator_t<span class="op">&lt;</span>V<span class="op">&gt;()</span>;</span>
<span id="cb10-36"><a href="#cb10-36"></a>        <span class="dt">bool</span> trailing_empty <span class="op">=</span> <span class="kw">false</span>;</span>
<span id="cb10-37"><a href="#cb10-37"></a></span>
<span id="cb10-38"><a href="#cb10-38"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb10-39"><a href="#cb10-39"></a>        iterator<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span>;</span>
<span id="cb10-40"><a href="#cb10-40"></a>        iterator<span class="op">(</span>split2_view<span class="op">*</span> p<span class="op">)</span></span>
<span id="cb10-41"><a href="#cb10-41"></a>            <span class="op">:</span> parent<span class="op">(</span>p<span class="op">)</span></span>
<span id="cb10-42"><a href="#cb10-42"></a>            , cur<span class="op">(</span>std<span class="op">::</span>ranges<span class="op">::</span>begin<span class="op">(</span>p<span class="op">-&gt;</span>base_<span class="op">))</span></span>
<span id="cb10-43"><a href="#cb10-43"></a>            , next<span class="op">(</span>lookup_next<span class="op">())</span></span>
<span id="cb10-44"><a href="#cb10-44"></a>        <span class="op">{</span> <span class="op">}</span></span>
<span id="cb10-45"><a href="#cb10-45"></a>        </span>
<span id="cb10-46"><a href="#cb10-46"></a>        iterator<span class="op">(</span>as_sentinel_t, split2_view<span class="op">*</span> p<span class="op">)</span></span>
<span id="cb10-47"><a href="#cb10-47"></a>            <span class="op">:</span> parent<span class="op">(</span>p<span class="op">)</span></span>
<span id="cb10-48"><a href="#cb10-48"></a>            , cur<span class="op">(</span>std<span class="op">::</span>ranges<span class="op">::</span>end<span class="op">(</span>p<span class="op">-&gt;</span>base_<span class="op">))</span></span>
<span id="cb10-49"><a href="#cb10-49"></a>            , next<span class="op">()</span></span>
<span id="cb10-50"><a href="#cb10-50"></a>        <span class="op">{</span> <span class="op">}</span></span>
<span id="cb10-51"><a href="#cb10-51"></a></span>
<span id="cb10-52"><a href="#cb10-52"></a>        <span class="kw">using</span> iterator_category <span class="op">=</span> std<span class="op">::</span>forward_iterator_tag;</span>
<span id="cb10-53"><a href="#cb10-53"></a>        <span class="kw">struct</span> reference <span class="op">:</span> subrange<span class="op">&lt;</span>iterator_t<span class="op">&lt;</span>V<span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb10-54"><a href="#cb10-54"></a>            <span class="kw">using</span> reference<span class="op">::</span>subrange<span class="op">::</span>subrange;</span>
<span id="cb10-55"><a href="#cb10-55"></a></span>
<span id="cb10-56"><a href="#cb10-56"></a>            <span class="kw">operator</span> std<span class="op">::</span>string_view<span class="op">()</span> <span class="kw">const</span></span>
<span id="cb10-57"><a href="#cb10-57"></a>                <span class="kw">requires</span> std<span class="op">::</span>same_as<span class="op">&lt;</span>range_value_t<span class="op">&lt;</span>V<span class="op">&gt;</span>, <span class="dt">char</span><span class="op">&gt;</span></span>
<span id="cb10-58"><a href="#cb10-58"></a>                      <span class="op">&amp;&amp;</span> contiguous_range<span class="op">&lt;</span>V<span class="op">&gt;</span></span>
<span id="cb10-59"><a href="#cb10-59"></a>            <span class="op">{</span></span>
<span id="cb10-60"><a href="#cb10-60"></a>                <span class="cf">return</span> <span class="op">{</span><span class="kw">this</span><span class="op">-&gt;</span>data<span class="op">()</span>, <span class="kw">this</span><span class="op">-&gt;</span>size<span class="op">()}</span>;</span>
<span id="cb10-61"><a href="#cb10-61"></a>            <span class="op">}</span>            </span>
<span id="cb10-62"><a href="#cb10-62"></a>        <span class="op">}</span>;</span>
<span id="cb10-63"><a href="#cb10-63"></a>        <span class="kw">using</span> value_type <span class="op">=</span> reference;</span>
<span id="cb10-64"><a href="#cb10-64"></a>        <span class="kw">using</span> difference_type <span class="op">=</span> std<span class="op">::</span><span class="dt">ptrdiff_t</span>;</span>
<span id="cb10-65"><a href="#cb10-65"></a></span>
<span id="cb10-66"><a href="#cb10-66"></a>        <span class="dt">bool</span> <span class="kw">operator</span><span class="op">==(</span>iterator <span class="kw">const</span><span class="op">&amp;</span> rhs<span class="op">)</span> <span class="kw">const</span> <span class="op">{</span></span>
<span id="cb10-67"><a href="#cb10-67"></a>            <span class="cf">return</span> cur <span class="op">==</span> rhs<span class="op">.</span>cur <span class="op">&amp;&amp;</span> trailing_empty <span class="op">==</span> rhs<span class="op">.</span>trailing_empty;</span>
<span id="cb10-68"><a href="#cb10-68"></a>        <span class="op">}</span></span>
<span id="cb10-69"><a href="#cb10-69"></a></span>
<span id="cb10-70"><a href="#cb10-70"></a>        <span class="kw">auto</span> lookup_next<span class="op">()</span> <span class="kw">const</span> <span class="op">-&gt;</span> iterator_t<span class="op">&lt;</span>V<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb10-71"><a href="#cb10-71"></a>            <span class="kw">auto</span> n <span class="op">=</span> std<span class="op">::</span>ranges<span class="op">::</span>search<span class="op">(</span></span>
<span id="cb10-72"><a href="#cb10-72"></a>                subrange<span class="op">(</span>cur, std<span class="op">::</span>ranges<span class="op">::</span>end<span class="op">(</span>parent<span class="op">-&gt;</span>base_<span class="op">))</span>,</span>
<span id="cb10-73"><a href="#cb10-73"></a>                parent<span class="op">-&gt;</span>pattern_</span>
<span id="cb10-74"><a href="#cb10-74"></a>                <span class="op">).</span>begin<span class="op">()</span>;</span>
<span id="cb10-75"><a href="#cb10-75"></a></span>
<span id="cb10-76"><a href="#cb10-76"></a>            <span class="cf">if</span> <span class="op">(</span>n <span class="op">!=</span> std<span class="op">::</span>ranges<span class="op">::</span>end<span class="op">(</span>parent<span class="op">-&gt;</span>base_<span class="op">)</span> <span class="kw">and</span> std<span class="op">::</span>ranges<span class="op">::</span>empty<span class="op">(</span>parent<span class="op">-&gt;</span>pattern_<span class="op">))</span> <span class="op">{</span></span>
<span id="cb10-77"><a href="#cb10-77"></a>                <span class="op">++</span>n;</span>
<span id="cb10-78"><a href="#cb10-78"></a>            <span class="op">}</span></span>
<span id="cb10-79"><a href="#cb10-79"></a></span>
<span id="cb10-80"><a href="#cb10-80"></a>            <span class="cf">return</span> n;</span>
<span id="cb10-81"><a href="#cb10-81"></a>        <span class="op">}</span></span>
<span id="cb10-82"><a href="#cb10-82"></a></span>
<span id="cb10-83"><a href="#cb10-83"></a>        <span class="kw">auto</span> <span class="kw">operator</span><span class="op">++()</span> <span class="op">-&gt;</span> iterator<span class="op">&amp;</span> <span class="op">{</span></span>
<span id="cb10-84"><a href="#cb10-84"></a>            cur <span class="op">=</span> next;</span>
<span id="cb10-85"><a href="#cb10-85"></a>            <span class="cf">if</span> <span class="op">(</span>cur <span class="op">!=</span> std<span class="op">::</span>ranges<span class="op">::</span>end<span class="op">(</span>parent<span class="op">-&gt;</span>base_<span class="op">))</span> <span class="op">{</span></span>
<span id="cb10-86"><a href="#cb10-86"></a>                std<span class="op">::</span>ranges<span class="op">::</span>advance<span class="op">(</span>cur, distance<span class="op">(</span>parent<span class="op">-&gt;</span>pattern_<span class="op">))</span>;</span>
<span id="cb10-87"><a href="#cb10-87"></a>                <span class="cf">if</span> <span class="op">(</span>cur <span class="op">==</span> std<span class="op">::</span>ranges<span class="op">::</span>end<span class="op">(</span>parent<span class="op">-&gt;</span>base_<span class="op">))</span> <span class="op">{</span></span>
<span id="cb10-88"><a href="#cb10-88"></a>                    trailing_empty <span class="op">=</span> <span class="kw">true</span>;</span>
<span id="cb10-89"><a href="#cb10-89"></a>                <span class="op">}</span></span>
<span id="cb10-90"><a href="#cb10-90"></a>                next <span class="op">=</span> lookup_next<span class="op">()</span>;</span>
<span id="cb10-91"><a href="#cb10-91"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb10-92"><a href="#cb10-92"></a>                trailing_empty <span class="op">=</span> <span class="kw">false</span>;</span>
<span id="cb10-93"><a href="#cb10-93"></a>            <span class="op">}</span></span>
<span id="cb10-94"><a href="#cb10-94"></a>            <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span>;</span>
<span id="cb10-95"><a href="#cb10-95"></a>        <span class="op">}</span></span>
<span id="cb10-96"><a href="#cb10-96"></a>        <span class="kw">auto</span> <span class="kw">operator</span><span class="op">++(</span><span class="dt">int</span><span class="op">)</span> <span class="op">-&gt;</span> iterator <span class="op">{</span></span>
<span id="cb10-97"><a href="#cb10-97"></a>            <span class="kw">auto</span> tmp <span class="op">=</span> <span class="op">*</span><span class="kw">this</span>;</span>
<span id="cb10-98"><a href="#cb10-98"></a>            <span class="op">++*</span><span class="kw">this</span>;</span>
<span id="cb10-99"><a href="#cb10-99"></a>            <span class="cf">return</span> tmp;</span>
<span id="cb10-100"><a href="#cb10-100"></a>        <span class="op">}</span></span>
<span id="cb10-101"><a href="#cb10-101"></a></span>
<span id="cb10-102"><a href="#cb10-102"></a>        <span class="kw">auto</span> <span class="kw">operator</span><span class="op">*()</span> <span class="kw">const</span> <span class="op">-&gt;</span> reference <span class="op">{</span></span>
<span id="cb10-103"><a href="#cb10-103"></a>            <span class="cf">return</span> <span class="op">{</span>cur, next<span class="op">}</span>;</span>
<span id="cb10-104"><a href="#cb10-104"></a>        <span class="op">}</span></span>
<span id="cb10-105"><a href="#cb10-105"></a>    <span class="op">}</span>;</span>
<span id="cb10-106"><a href="#cb10-106"></a></span>
<span id="cb10-107"><a href="#cb10-107"></a>    <span class="kw">struct</span> sentinel <span class="op">{</span></span>
<span id="cb10-108"><a href="#cb10-108"></a>        <span class="dt">bool</span> <span class="kw">operator</span><span class="op">==(</span>iterator <span class="kw">const</span><span class="op">&amp;</span> rhs<span class="op">)</span> <span class="kw">const</span> <span class="op">{</span></span>
<span id="cb10-109"><a href="#cb10-109"></a>            <span class="cf">return</span> rhs<span class="op">.</span>cur <span class="op">==</span> sentinel <span class="kw">and</span> <span class="kw">not</span> rhs<span class="op">.</span>trailing_empty;</span>
<span id="cb10-110"><a href="#cb10-110"></a>        <span class="op">}</span></span>
<span id="cb10-111"><a href="#cb10-111"></a></span>
<span id="cb10-112"><a href="#cb10-112"></a>        sentinel_t<span class="op">&lt;</span>V<span class="op">&gt;</span> sentinel;</span>
<span id="cb10-113"><a href="#cb10-113"></a>    <span class="op">}</span>;</span>
<span id="cb10-114"><a href="#cb10-114"></a></span>
<span id="cb10-115"><a href="#cb10-115"></a></span>
<span id="cb10-116"><a href="#cb10-116"></a>    <span class="kw">auto</span> begin<span class="op">()</span> <span class="op">-&gt;</span> iterator <span class="op">{</span></span>
<span id="cb10-117"><a href="#cb10-117"></a>        <span class="cf">if</span> <span class="op">(</span><span class="kw">not</span> cached_begin_<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-118"><a href="#cb10-118"></a>            cached_begin_<span class="op">.</span>emplace<span class="op">(</span><span class="kw">this</span><span class="op">)</span>;</span>
<span id="cb10-119"><a href="#cb10-119"></a>        <span class="op">}</span></span>
<span id="cb10-120"><a href="#cb10-120"></a>        <span class="cf">return</span> <span class="op">*</span>cached_begin_;</span>
<span id="cb10-121"><a href="#cb10-121"></a>    <span class="op">}</span></span>
<span id="cb10-122"><a href="#cb10-122"></a>    <span class="kw">auto</span> end<span class="op">()</span> <span class="op">-&gt;</span> sentinel <span class="op">{</span></span>
<span id="cb10-123"><a href="#cb10-123"></a>        <span class="cf">return</span> <span class="op">{</span>std<span class="op">::</span>ranges<span class="op">::</span>end<span class="op">(</span>base_<span class="op">)}</span>;</span>
<span id="cb10-124"><a href="#cb10-124"></a>    <span class="op">}</span></span>
<span id="cb10-125"><a href="#cb10-125"></a></span>
<span id="cb10-126"><a href="#cb10-126"></a>    <span class="kw">auto</span> end<span class="op">()</span> <span class="op">-&gt;</span> iterator <span class="kw">requires</span> common_range<span class="op">&lt;</span>V<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb10-127"><a href="#cb10-127"></a>        <span class="cf">return</span> <span class="op">{</span>as_sentinel_t<span class="op">()</span>, <span class="kw">this</span><span class="op">}</span>;</span>
<span id="cb10-128"><a href="#cb10-128"></a>    <span class="op">}</span></span>
<span id="cb10-129"><a href="#cb10-129"></a></span>
<span id="cb10-130"><a href="#cb10-130"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb10-131"><a href="#cb10-131"></a>    V base_ <span class="op">=</span> V<span class="op">()</span>;</span>
<span id="cb10-132"><a href="#cb10-132"></a>    Pattern pattern_ <span class="op">=</span> Pattern<span class="op">()</span>;</span>
<span id="cb10-133"><a href="#cb10-133"></a>    std<span class="op">::</span>optional<span class="op">&lt;</span>iterator<span class="op">&gt;</span> cached_begin_;</span>
<span id="cb10-134"><a href="#cb10-134"></a><span class="op">}</span>;</span>
<span id="cb10-135"><a href="#cb10-135"></a></span>
<span id="cb10-136"><a href="#cb10-136"></a><span class="co">// It&#39;s okay if you&#39;re just writing a paper?</span></span>
<span id="cb10-137"><a href="#cb10-137"></a><span class="kw">namespace</span> std<span class="op">::</span>ranges <span class="op">{</span></span>
<span id="cb10-138"><a href="#cb10-138"></a>    <span class="kw">template</span><span class="op">&lt;</span>forward_range V, forward_range Pattern<span class="op">&gt;</span></span>
<span id="cb10-139"><a href="#cb10-139"></a>    <span class="kw">requires</span> view<span class="op">&lt;</span>V<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> view<span class="op">&lt;</span>Pattern<span class="op">&gt;</span></span>
<span id="cb10-140"><a href="#cb10-140"></a>      <span class="op">&amp;&amp;</span> indirectly_comparable<span class="op">&lt;</span>iterator_t<span class="op">&lt;</span>V<span class="op">&gt;</span>, iterator_t<span class="op">&lt;</span>Pattern<span class="op">&gt;</span>, equal_to<span class="op">&gt;</span></span>
<span id="cb10-141"><a href="#cb10-141"></a>    <span class="kw">class</span> split_view<span class="op">&lt;</span>V, Pattern<span class="op">&gt;</span> <span class="op">:</span> <span class="kw">public</span> split2_view<span class="op">&lt;</span>V, Pattern<span class="op">&gt;</span></span>
<span id="cb10-142"><a href="#cb10-142"></a>    <span class="op">{</span></span>
<span id="cb10-143"><a href="#cb10-143"></a>        <span class="kw">using</span> split2_view<span class="op">&lt;</span>V, Pattern<span class="op">&gt;::</span>split2_view;</span>
<span id="cb10-144"><a href="#cb10-144"></a>    <span class="op">}</span>;</span>
<span id="cb10-145"><a href="#cb10-145"></a><span class="op">}</span></span></code></pre></div>
<h1 data-number="5" style="border-bottom:1px solid #cccccc" id="wording"><span class="header-section-number">5</span> Wording<a href="#wording" class="self-link"></a></h1>
<p>Change <span>24.2
 <a href="https://wg21.link/ranges.syn">[ranges.syn]</a></span> to add the new view:</p>
<div>
<div class="sourceCode" id="cb11"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb11-1"><a href="#cb11-1"></a>  // [range.split], split view</span>
<span id="cb11-2"><a href="#cb11-2"></a>  template&lt;class R&gt;</span>
<span id="cb11-3"><a href="#cb11-3"></a>    concept tiny-range = see below;   // exposition only</span>
<span id="cb11-4"><a href="#cb11-4"></a></span>
<span id="cb11-5"><a href="#cb11-5"></a>  template&lt;input_range V, forward_range Pattern&gt;</span>
<span id="cb11-6"><a href="#cb11-6"></a>    requires view&lt;V&gt; &amp;&amp; view&lt;Pattern&gt; &amp;&amp;</span>
<span id="cb11-7"><a href="#cb11-7"></a>             indirectly_comparable&lt;iterator_t&lt;V&gt;, iterator_t&lt;Pattern&gt;, ranges::equal_to&gt; &amp;&amp;</span>
<span id="cb11-8"><a href="#cb11-8"></a>             (forward_range&lt;V&gt; || tiny-range&lt;Pattern&gt;)</span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="st">- class split_view;</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="va">+ class <span class="diffins">lazy_</span>split_view;</span></span>
<span id="cb11-11"><a href="#cb11-11"></a></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="va">+ template&lt;forward_range V, forward_range Pattern&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="va">+   requires view&lt;V&gt; &amp;&amp; view&lt;Pattern&gt; &amp;&amp;</span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="va">+            indirectly_comparable&lt;iterator_t&lt;V&gt;, iterator_t&lt;Pattern&gt;, ranges::equal_to&gt;</span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="va">+ class split_view;</span></span>
<span id="cb11-16"><a href="#cb11-16"></a></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="st">- namespace views { inline constexpr unspecified split = unspecified; }</span></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="va">+ namespace views {</span></span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="va">+   inline constexpr <em>unspecified</em> lazy_split = <em>unspecified</em>;</span></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="va">+   inline constexpr <em>unspecified</em> split = <em>unspecified</em>;</span></span>
<span id="cb11-21"><a href="#cb11-21"></a><span class="va">+ }</span></span></code></pre></div>
</div>
<h2 data-number="5.1" id="wording-for-split---lazy_split"><span class="header-section-number">5.1</span> Wording for <code class="sourceCode cpp">split</code> -&gt; <code class="sourceCode cpp">lazy_split</code><a href="#wording-for-split---lazy_split" class="self-link"></a></h2>
<p>Rename all references to <code class="sourceCode cpp">split_view</code> in <span>24.7.12
 <a href="https://wg21.link/range.split">[range.split]</a></span> to <code class="sourceCode cpp">lazy_split_view</code>, and rename all the clauses from [range.split.meow] to [range.lazy.split.meow].</p>
<p>Add <code class="sourceCode cpp">base<span class="op">()</span></code> overloads to <code class="sourceCode cpp"><span class="addu">lazy_</span>split_view<span class="op">::</span><em>inner-iterator</em></code>’ in <span>24.7.12.5
 <a href="https://wg21.link/range.split.inner">[range.split.inner]</a></span>:</p>
<blockquote>
<div>
<div class="sourceCode" id="cb12"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb12-1"><a href="#cb12-1"></a>namespace std::ranges {</span>
<span id="cb12-2"><a href="#cb12-2"></a>  template&lt;input_range V, forward_range Pattern&gt;</span>
<span id="cb12-3"><a href="#cb12-3"></a>    requires view&lt;V&gt; &amp;&amp; view&lt;Pattern&gt; &amp;&amp;</span>
<span id="cb12-4"><a href="#cb12-4"></a>             indirectly_comparable&lt;iterator_t&lt;V&gt;, iterator_t&lt;Pattern&gt;, ranges::equal_to&gt; &amp;&amp;</span>
<span id="cb12-5"><a href="#cb12-5"></a>             (forward_range&lt;V&gt; || tiny-range&lt;Pattern&gt;)</span>
<span id="cb12-6"><a href="#cb12-6"></a>  template&lt;bool Const&gt;</span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="st">- struct split_view&lt;V, Pattern&gt;::<em>inner-iterator</em> {</span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="va">+ struct <span class="diffins">lazy_</span>split_view&lt;V, Pattern&gt;::<em>inner-iterator</em> {</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>  private:</span>
<span id="cb12-10"><a href="#cb12-10"></a>    using <em>Base</em> = <em>maybe-const</em>&lt;Const, V&gt;;                 // exposition only</span>
<span id="cb12-11"><a href="#cb12-11"></a>    <em>outer-iterator</em>&lt;Const&gt; <em>i_</em> = <em>outer-iterator</em>&lt;Const&gt;(); // exposition only</span>
<span id="cb12-12"><a href="#cb12-12"></a>    bool <em>incremented_</em> = false;                          // exposition only</span>
<span id="cb12-13"><a href="#cb12-13"></a>  public:</span>
<span id="cb12-14"><a href="#cb12-14"></a>    using iterator_concept  = typename <em>outer-iterator</em>&lt;Const&gt;::iterator_concept;</span>
<span id="cb12-15"><a href="#cb12-15"></a>    using iterator_category = <em>see below</em>;</span>
<span id="cb12-16"><a href="#cb12-16"></a>    using value_type        = range_value_t&lt;<em>Base</em>&gt;;</span>
<span id="cb12-17"><a href="#cb12-17"></a>    using difference_type   = range_difference_t&lt;<em>Base</em>&gt;;</span>
<span id="cb12-18"><a href="#cb12-18"></a></span>
<span id="cb12-19"><a href="#cb12-19"></a>    <em>inner-iterator</em>() = default;</span>
<span id="cb12-20"><a href="#cb12-20"></a>    constexpr explicit <em>inner-iterator</em>(<em>outer-iterator</em>&lt;Const&gt; i);</span>
<span id="cb12-21"><a href="#cb12-21"></a></span>
<span id="cb12-22"><a href="#cb12-22"></a><span class="va">+   constexpr iterator_t&lt;<em>Base</em>&gt; base() const&amp;</span></span>
<span id="cb12-23"><a href="#cb12-23"></a><span class="va">+       requires copyable&lt;iterator_t&lt;<em>Base</em>&gt;&gt;;</span></span>
<span id="cb12-24"><a href="#cb12-24"></a><span class="va">+   constexpr iterator_t&lt;<em>Base</em>&gt; base() &amp;&amp;;</span></span>
<span id="cb12-25"><a href="#cb12-25"></a></span>
<span id="cb12-26"><a href="#cb12-26"></a>    constexpr decltype(auto) operator*() const { return *<em>i</em>_.<em>current</em>; }</span>
<span id="cb12-27"><a href="#cb12-27"></a></span>
<span id="cb12-28"><a href="#cb12-28"></a>    constexpr <em>inner-iterator</em>&amp; operator++();</span>
<span id="cb12-29"><a href="#cb12-29"></a>    constexpr decltype(auto) operator++(int) {</span>
<span id="cb12-30"><a href="#cb12-30"></a>      if constexpr (forward_range&lt;V&gt;) {</span>
<span id="cb12-31"><a href="#cb12-31"></a>        auto tmp = *this;</span>
<span id="cb12-32"><a href="#cb12-32"></a>        ++*this;</span>
<span id="cb12-33"><a href="#cb12-33"></a>        return tmp;</span>
<span id="cb12-34"><a href="#cb12-34"></a>      } else</span>
<span id="cb12-35"><a href="#cb12-35"></a>        ++*this;</span>
<span id="cb12-36"><a href="#cb12-36"></a>    }</span>
<span id="cb12-37"><a href="#cb12-37"></a></span>
<span id="cb12-38"><a href="#cb12-38"></a>    friend constexpr bool operator==(const <em>inner-iterator</em>&amp; x, const <em>inner-iterator</em>&amp; y)</span>
<span id="cb12-39"><a href="#cb12-39"></a>      requires forward_range&lt;Base&gt;;</span>
<span id="cb12-40"><a href="#cb12-40"></a></span>
<span id="cb12-41"><a href="#cb12-41"></a>    friend constexpr bool operator==(const <em>inner-iterator</em>&amp; x, default_sentinel_t);</span>
<span id="cb12-42"><a href="#cb12-42"></a></span>
<span id="cb12-43"><a href="#cb12-43"></a>    friend constexpr decltype(auto) iter_move(const <em>inner-iterator</em>&amp; i)</span>
<span id="cb12-44"><a href="#cb12-44"></a>    noexcept(noexcept(ranges::iter_move(i.<em>i_</em>.<em>current</em>))) {</span>
<span id="cb12-45"><a href="#cb12-45"></a>      return ranges::iter_move(i.<em>i_</em>.<em>current</em>);</span>
<span id="cb12-46"><a href="#cb12-46"></a>    }</span>
<span id="cb12-47"><a href="#cb12-47"></a></span>
<span id="cb12-48"><a href="#cb12-48"></a>    friend constexpr void iter_swap(const <em>inner-iterator</em>&amp; x, const <em>inner-iterator</em>&amp; y)</span>
<span id="cb12-49"><a href="#cb12-49"></a>      noexcept(noexcept(ranges::iter_swap(x.<em>i_</em>.<em>current</em>, y.<em>i_</em>.<em>current</em>)))</span>
<span id="cb12-50"><a href="#cb12-50"></a>      requires indirectly_swappable&lt;iterator_t&lt;<em>Base</em>&gt;&gt;;</span>
<span id="cb12-51"><a href="#cb12-51"></a>  };</span>
<span id="cb12-52"><a href="#cb12-52"></a>}</span></code></pre></div>
</div>
</blockquote>
<p>And add text describing those two new functions, just before <code class="sourceCode cpp"><span class="kw">operator</span><span class="op">++</span></code>:</p>
<blockquote>
<div class="addu">
<div class="sourceCode" id="cb13"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb13-1"><a href="#cb13-1"></a>constexpr iterator_t&lt;<em>Base</em>&gt; base() const&amp;</span>
<span id="cb13-2"><a href="#cb13-2"></a>    requires copyable&lt;iterator_t&lt;<em>Base</em>&gt;&gt;;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">a</a></span> <em>Effects</em>: Equivalent to: <code class="sourceCode cpp"><span class="cf">return</span> <em>i_</em><span class="op">.</span><em>current</em>;</code></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb14-1"><a href="#cb14-1"></a>constexpr iterator_t&lt;<em>Base</em>&gt; base() &amp;&amp;;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">b</a></span> <em>Effects</em>: Equivalent to: <code class="sourceCode cpp"><span class="cf">return</span> std<span class="op">::</span>move<span class="op">(</span><em>i_</em><span class="op">.</span><em>current</em><span class="op">)</span>;</code></p>
</div>
<div class="sourceCode" id="cb15"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb15-1"><a href="#cb15-1"></a>constexpr <em>inner-iterator</em>&amp; operator++();</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">3</a></span> <em>Effects</em>: […]</p>
</blockquote>
<h2 data-number="5.2" id="wording-for-new-split"><span class="header-section-number">5.2</span> Wording for new <code class="sourceCode cpp">split</code><a href="#wording-for-new-split" class="self-link"></a></h2>
<p><span class="ednote" style="color: #0000ff">[ Editor&#39;s note: All of the wording here is new, so I’m not going to highlight it in green. To help differentiate that these are all new clauses, I’m going to refer to them as [range.split2] but the intent here is that they would be added under the name [range.split] throughout ]</span></p>
<h3 data-number="5.2.1" id="overview-range.split2.overview"><span class="header-section-number">5.2.1</span> Overview [range.split2.overview]<a href="#overview-range.split2.overview" class="self-link"></a></h3>
<blockquote>
<p><span class="marginalizedparent"><a class="marginalized">1</a></span> <code class="sourceCode cpp">split_view</code> takes a <code class="sourceCode cpp">view</code> and a delimiter, and splits the <code class="sourceCode cpp">view</code> into <code class="sourceCode cpp">subrange</code>s on the delimiter. The delimiter can be a single element or a <code class="sourceCode cpp">view</code> of elements. <span class="ednote" style="color: #0000ff">[ Editor&#39;s note: NB: code font on <code class="sourceCode default">subrange</code> since they are, specifically, <code class="sourceCode default">subrange</code>s ]</span></p>
<p><span class="marginalizedparent"><a class="marginalized">2</a></span> The name <code class="sourceCode cpp">views​<span class="op">::</span>​split</code> denotes a range adaptor object ([range.adaptor.object]). Given subexpressions <code class="sourceCode cpp">E</code> and <code class="sourceCode cpp">F</code>, the expression <code class="sourceCode cpp">views​<span class="op">::</span>​split<span class="op">(</span>E, F<span class="op">)</span></code> is expression-equivalent to <code class="sourceCode cpp">split_view<span class="op">(</span>E, F<span class="op">)</span></code>.</p>
<p><span class="marginalizedparent"><a class="marginalized">3</a></span> [<em>Example 1</em>:</p>
<blockquote>
<div class="sourceCode" id="cb16"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1"></a>string str<span class="op">{</span><span class="st">&quot;the quick brown fox&quot;</span><span class="op">}</span>;</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="cf">for</span> <span class="op">(</span>span<span class="op">&lt;</span><span class="dt">char</span> <span class="kw">const</span><span class="op">&gt;</span> word <span class="op">:</span> split<span class="op">(</span>str, <span class="ch">&#39; &#39;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">char</span> ch <span class="op">:</span> word<span class="op">)</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>    cout <span class="op">&lt;&lt;</span> ch;</span>
<span id="cb16-5"><a href="#cb16-5"></a>  cout <span class="op">&lt;&lt;</span> <span class="ch">&#39;*&#39;</span>;</span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="op">}</span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="co">// The above prints: the*quick*brown*fox*</span></span></code></pre></div>
<p><span class="ednote" style="color: #0000ff">[ Editor&#39;s note: Same example as we have for split today, except explicitly iterating via <code class="sourceCode default">span</code> ]</span></p>
</blockquote>
<p>— <em>end example</em>]</p>
</blockquote>
<h3 data-number="5.2.2" id="class-template-split_view-range.split2.view"><span class="header-section-number">5.2.2</span> Class template <code class="sourceCode cpp">split_view</code> [range.split2.view]<a href="#class-template-split_view-range.split2.view" class="self-link"></a></h3>
<blockquote>
<div class="sourceCode" id="cb17"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1"></a>  <span class="kw">template</span><span class="op">&lt;</span>forward_range V, forward_range Pattern<span class="op">&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>    <span class="kw">requires</span> view<span class="op">&lt;</span>V<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> view<span class="op">&lt;</span>Pattern<span class="op">&gt;</span> <span class="op">&amp;&amp;</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>             indirectly_comparable<span class="op">&lt;</span>iterator_t<span class="op">&lt;</span>V<span class="op">&gt;</span>, iterator_t<span class="op">&lt;</span>Pattern<span class="op">&gt;</span>, ranges<span class="op">::</span>equal_to<span class="op">&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="kw">class</span> split_view <span class="op">:</span> <span class="kw">public</span> view_interface<span class="op">&lt;</span>split_view<span class="op">&lt;</span>V, Pattern<span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="kw">private</span><span class="op">:</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>    V <em>base_</em> <span class="op">=</span> V<span class="op">()</span>;                              <span class="co">// exposition only</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>    Pattern <em>pattern_</em> <span class="op">=</span> Pattern<span class="op">()</span>;               <span class="co">// exposition only</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>    <span class="co">// [range.split2.iterator], class split_view​::​<em>iterator</em></span></span>
<span id="cb17-9"><a href="#cb17-9"></a>    <span class="kw">struct</span> <em>iterator</em>;                            <span class="co">// exposition only</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>    <span class="co">// [range.split2.sentinel], class split_view​::<em>sentinel</em></span></span>
<span id="cb17-11"><a href="#cb17-11"></a>    <span class="kw">struct</span> <em>sentinel</em>;                            <span class="co">// exposition only</span></span>
<span id="cb17-12"><a href="#cb17-12"></a>  <span class="kw">public</span><span class="op">:</span></span>
<span id="cb17-13"><a href="#cb17-13"></a>    split_view<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span>;</span>
<span id="cb17-14"><a href="#cb17-14"></a>    <span class="kw">constexpr</span> split_view<span class="op">(</span>V base, Pattern pattern<span class="op">)</span>;</span>
<span id="cb17-15"><a href="#cb17-15"></a></span>
<span id="cb17-16"><a href="#cb17-16"></a>    <span class="kw">template</span><span class="op">&lt;</span>forward_range R<span class="op">&gt;</span></span>
<span id="cb17-17"><a href="#cb17-17"></a>      <span class="kw">requires</span> constructible_from<span class="op">&lt;</span>V, views<span class="op">::</span>all_t<span class="op">&lt;</span>R<span class="op">&gt;&gt;</span> <span class="op">&amp;&amp;</span></span>
<span id="cb17-18"><a href="#cb17-18"></a>               constructible_from<span class="op">&lt;</span>Pattern, single_view<span class="op">&lt;</span>range_value_t<span class="op">&lt;</span>R<span class="op">&gt;&gt;&gt;</span></span>
<span id="cb17-19"><a href="#cb17-19"></a>    <span class="kw">constexpr</span> split_view<span class="op">(</span>R<span class="op">&amp;&amp;</span> r, range_value_t<span class="op">&lt;</span>R<span class="op">&gt;</span> e<span class="op">)</span>;</span>
<span id="cb17-20"><a href="#cb17-20"></a></span>
<span id="cb17-21"><a href="#cb17-21"></a>    <span class="kw">constexpr</span> V base<span class="op">()</span> <span class="kw">const</span><span class="op">&amp;</span> <span class="kw">requires</span> copy_constructible<span class="op">&lt;</span>V<span class="op">&gt;</span> <span class="op">{</span> <span class="cf">return</span> <em>base_</em>; <span class="op">}</span></span>
<span id="cb17-22"><a href="#cb17-22"></a>    <span class="kw">constexpr</span> V base<span class="op">()</span> <span class="op">&amp;&amp;</span> <span class="op">{</span> <span class="cf">return</span> std<span class="op">::</span>move<span class="op">(</span><em>base_</em><span class="op">)</span>; <span class="op">}</span></span>
<span id="cb17-23"><a href="#cb17-23"></a></span>
<span id="cb17-24"><a href="#cb17-24"></a>    <span class="kw">constexpr</span> <em>iterator</em> begin<span class="op">()</span>;</span>
<span id="cb17-25"><a href="#cb17-25"></a>    </span>
<span id="cb17-26"><a href="#cb17-26"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> end<span class="op">()</span> <span class="op">{</span></span>
<span id="cb17-27"><a href="#cb17-27"></a>        <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>common_range<span class="op">&lt;</span>V<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb17-28"><a href="#cb17-28"></a>            <span class="cf">return</span> <em>iterator</em><span class="op">{*</span><span class="kw">this</span>, ranges<span class="op">::</span>end<span class="op">(</span><em>base_</em><span class="op">)</span>, <span class="op">{}}</span>;</span>
<span id="cb17-29"><a href="#cb17-29"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb17-30"><a href="#cb17-30"></a>            <span class="cf">return</span> <em>sentinel</em><span class="op">{*</span><span class="kw">this</span><span class="op">}</span>;</span>
<span id="cb17-31"><a href="#cb17-31"></a>        <span class="op">}</span></span>
<span id="cb17-32"><a href="#cb17-32"></a>    <span class="op">}</span></span>
<span id="cb17-33"><a href="#cb17-33"></a>    </span>
<span id="cb17-34"><a href="#cb17-34"></a>    <span class="kw">constexpr</span> iterator_t<span class="op">&lt;</span>V<span class="op">&gt;</span> <em>find-next</em><span class="op">(</span>iterator_t<span class="op">&lt;</span>V<span class="op">&gt;)</span>; <span class="co">// exposition only</span></span>
<span id="cb17-35"><a href="#cb17-35"></a>  <span class="op">}</span>;</span>
<span id="cb17-36"><a href="#cb17-36"></a></span>
<span id="cb17-37"><a href="#cb17-37"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> R, <span class="kw">class</span> P<span class="op">&gt;</span></span>
<span id="cb17-38"><a href="#cb17-38"></a>    split_view<span class="op">(</span>R<span class="op">&amp;&amp;</span>, P<span class="op">&amp;&amp;)</span> <span class="op">-&gt;</span> split_view<span class="op">&lt;</span>views<span class="op">::</span>all_t<span class="op">&lt;</span>R<span class="op">&gt;</span>, views<span class="op">::</span>all_t<span class="op">&lt;</span>P<span class="op">&gt;&gt;</span>;</span>
<span id="cb17-39"><a href="#cb17-39"></a></span>
<span id="cb17-40"><a href="#cb17-40"></a>  <span class="kw">template</span><span class="op">&lt;</span>forward_range R<span class="op">&gt;</span></span>
<span id="cb17-41"><a href="#cb17-41"></a>    split_view<span class="op">(</span>R<span class="op">&amp;&amp;</span>, range_value_t<span class="op">&lt;</span>R<span class="op">&gt;)</span></span>
<span id="cb17-42"><a href="#cb17-42"></a>      <span class="op">-&gt;</span> split_view<span class="op">&lt;</span>views<span class="op">::</span>all_t<span class="op">&lt;</span>R<span class="op">&gt;</span>, single_view<span class="op">&lt;</span>range_value_t<span class="op">&lt;</span>R<span class="op">&gt;&gt;&gt;</span>;</span>
<span id="cb17-43"><a href="#cb17-43"></a><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb18-1"><a href="#cb18-1"></a>constexpr split_view(V base, Pattern pattern);</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">1</a></span> <em>Effects</em>: Initializes <code class="sourceCode cpp"><em>base_</em></code> with <code class="sourceCode cpp">std​<span class="op">::</span>​move<span class="op">(</span>base<span class="op">)</span></code>, and <code class="sourceCode cpp"><em>pattern_</em></code> with <code class="sourceCode cpp">std​<span class="op">::</span>​move<span class="op">(</span>pattern<span class="op">)</span></code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb19-1"><a href="#cb19-1"></a>template&lt;forward_range R&gt;</span>
<span id="cb19-2"><a href="#cb19-2"></a>  requires constructible_from&lt;V, views::all_t&lt;R&gt;&gt; &amp;&amp;</span>
<span id="cb19-3"><a href="#cb19-3"></a>           constructible_from&lt;Pattern, single_view&lt;range_value_t&lt;R&gt;&gt;&gt;</span>
<span id="cb19-4"><a href="#cb19-4"></a>constexpr split_view(R&amp;&amp; r, range_value_t&lt;R&gt; e);</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">2</a></span> <em>Effects</em>: Initializes <code class="sourceCode cpp"><em>base_</em></code> with <code class="sourceCode cpp">views​<span class="op">::</span>​all<span class="op">(</span>std​<span class="op">::</span>​forward<span class="op">&lt;</span>R<span class="op">&gt;(</span>r<span class="op">))</span></code>, and <code class="sourceCode cpp"><em>pattern_</em></code> with <code class="sourceCode cpp">single_view<span class="op">{</span>​std​<span class="op">::</span>​move<span class="op">(</span>e<span class="op">)}</span></code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb20-1"><a href="#cb20-1"></a>constexpr iterator begin();</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">3</a></span> <em>Returns</em>: <code class="sourceCode cpp"><span class="op">{*</span><span class="kw">this</span>, ranges<span class="op">::</span>begin<span class="op">(</span><em>base_</em><span class="op">)</span>, <em>find-next</em><span class="op">(</span>ranges<span class="op">::</span>begin<span class="op">(</span><em>base_</em><span class="op">))}</span></code>.</p>
<p><span class="marginalizedparent"><a class="marginalized">4</a></span> <em>Remarks</em>: In order to provide the amortized constant time complexity required by the <code class="sourceCode cpp">range</code> concept, this function caches the result within the <code class="sourceCode cpp">split_view</code> for use on subsequent calls.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb21-1"><a href="#cb21-1"></a>constexpr iterator_t&lt;V&gt; <em>find-next</em>(iterator_t&lt;V&gt; it); // exposition only</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">5</a></span> <em>Effects</em>: Equivalent to:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">auto</span> n <span class="op">=</span> ranges<span class="op">::</span>search<span class="op">(</span>subrange<span class="op">(</span>it, ranges<span class="op">::</span>end<span class="op">(</span><em>base_</em><span class="op">))</span>, <em>pattern_</em><span class="op">).</span>begin<span class="op">()</span>;</span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="cf">if</span> <span class="op">(</span>n <span class="op">!=</span> ranges<span class="op">::</span>end<span class="op">(</span><em>base_</em><span class="op">)</span> <span class="op">&amp;&amp;</span> ranges<span class="op">::</span>empty<span class="op">(</span><em>pattern_</em><span class="op">))</span> <span class="op">{</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>    <span class="op">++</span>n;</span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="op">}</span></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="cf">return</span> n;</span></code></pre></div>
</blockquote>
<h3 data-number="5.2.3" id="class-template-split_view_iterator_-range.split2.iterator"><span class="header-section-number">5.2.3</span> Class template <code class="sourceCode cpp">split_view​<span class="op">::</span><em>​iterator</em></code> [range.split2.iterator]<a href="#class-template-split_view_iterator_-range.split2.iterator" class="self-link"></a></h3>
<blockquote>
<div class="sourceCode" id="cb23"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb23-1"><a href="#cb23-1"></a>  <span class="kw">template</span><span class="op">&lt;</span>forward_range V, forward_range Pattern<span class="op">&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>    <span class="kw">requires</span> view<span class="op">&lt;</span>V<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> view<span class="op">&lt;</span>Pattern<span class="op">&gt;</span> <span class="op">&amp;&amp;</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>             indirectly_comparable<span class="op">&lt;</span>iterator_t<span class="op">&lt;</span>V<span class="op">&gt;</span>, iterator_t<span class="op">&lt;</span>Pattern<span class="op">&gt;</span>, ranges<span class="op">::</span>equal_to<span class="op">&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="kw">class</span> split_view<span class="op">&lt;</span>V, Pattern<span class="op">&gt;::</span><em>iterator</em> <span class="op">{</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>  <span class="kw">private</span><span class="op">:</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>    split_view<span class="op">*</span> <em>parent_</em> <span class="op">=</span> <span class="kw">nullptr</span>;          <span class="co">// exposition only</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>    iterator_t<span class="op">&lt;</span>V<span class="op">&gt;</span> <em>cur_</em> <span class="op">=</span> iterator_t<span class="op">&lt;</span>V<span class="op">&gt;()</span>;   <span class="co">// exposition only</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>    iterator_t<span class="op">&lt;</span>V<span class="op">&gt;</span> <em>next_</em> <span class="op">=</span> iterator_t<span class="op">&lt;</span>V<span class="op">&gt;()</span>;  <span class="co">// exposition only</span></span>
<span id="cb23-9"><a href="#cb23-9"></a>    <span class="dt">bool</span> <em>trailing_empty_</em> <span class="op">=</span> <span class="kw">false</span>;           <span class="co">// exposition only</span></span>
<span id="cb23-10"><a href="#cb23-10"></a>    </span>
<span id="cb23-11"><a href="#cb23-11"></a>  <span class="kw">public</span><span class="op">:</span></span>
<span id="cb23-12"><a href="#cb23-12"></a>    <span class="kw">using</span> iterator_concept <span class="op">=</span> forward_iterator_tag;</span>
<span id="cb23-13"><a href="#cb23-13"></a>    <span class="kw">using</span> iterator_category <span class="op">=</span> input_iterator_tag;</span>
<span id="cb23-14"><a href="#cb23-14"></a>    <span class="kw">using</span> value_type <span class="op">=</span> subrange<span class="op">&lt;</span>iterator_t<span class="op">&lt;</span>V<span class="op">&gt;&gt;</span>;</span>
<span id="cb23-15"><a href="#cb23-15"></a>    <span class="kw">using</span> difference_type <span class="op">=</span> range_difference_t<span class="op">&lt;</span>V<span class="op">&gt;</span>;</span>
<span id="cb23-16"><a href="#cb23-16"></a>    </span>
<span id="cb23-17"><a href="#cb23-17"></a>    <em>iterator</em><span class="op">()</span> <span class="op">=</span> <span class="cf">default</span>;</span>
<span id="cb23-18"><a href="#cb23-18"></a>    <span class="kw">constexpr</span> iterator<span class="op">(</span>split_view<span class="op">&amp;</span> parent, iterator_t<span class="op">&lt;</span>V<span class="op">&gt;</span> current, iterator_t<span class="op">&lt;</span>V<span class="op">&gt;</span> next<span class="op">)</span>;</span>
<span id="cb23-19"><a href="#cb23-19"></a></span>
<span id="cb23-20"><a href="#cb23-20"></a>    <span class="kw">constexpr</span> iterator_t<span class="op">&lt;</span>V<span class="op">&gt;</span> base<span class="op">()</span> <span class="kw">const</span> <span class="op">&amp;</span></span>
<span id="cb23-21"><a href="#cb23-21"></a>      <span class="kw">requires</span> copyable<span class="op">&lt;</span>iterator_t<span class="op">&lt;</span>V<span class="op">&gt;&gt;</span>;</span>
<span id="cb23-22"><a href="#cb23-22"></a>    <span class="kw">constexpr</span> iterator_t<span class="op">&lt;</span>V<span class="op">&gt;</span> base<span class="op">()</span> <span class="op">&amp;&amp;</span>;</span>
<span id="cb23-23"><a href="#cb23-23"></a>    <span class="kw">constexpr</span> value_type <span class="kw">operator</span><span class="op">*()</span> <span class="kw">const</span>;</span>
<span id="cb23-24"><a href="#cb23-24"></a></span>
<span id="cb23-25"><a href="#cb23-25"></a>    <span class="kw">constexpr</span> <em>iterator</em><span class="op">&amp;</span> <span class="kw">operator</span><span class="op">++()</span>;</span>
<span id="cb23-26"><a href="#cb23-26"></a>    <span class="kw">constexpr</span> <em>iterator</em> <span class="kw">operator</span><span class="op">++(</span><span class="dt">int</span><span class="op">)</span>;</span>
<span id="cb23-27"><a href="#cb23-27"></a></span>
<span id="cb23-28"><a href="#cb23-28"></a>    <span class="kw">friend</span> <span class="kw">constexpr</span> <span class="dt">bool</span> <span class="kw">operator</span><span class="op">==(</span><span class="kw">const</span> <em>iterator</em><span class="op">&amp;</span> x, <span class="kw">const</span> <em>iterator</em><span class="op">&amp;</span> y<span class="op">)</span></span>
<span id="cb23-29"><a href="#cb23-29"></a>  <span class="op">}</span>;</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb24-1"><a href="#cb24-1"></a>constexpr iterator(split_view&amp; parent, iterator_t&lt;V&gt; current, iterator_t&lt;V&gt; next);</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">1</a></span> <em>Effects</em>: Initializes <code class="sourceCode cpp"><em>parent_</em></code> with <code class="sourceCode cpp">addressof<span class="op">(</span>parent<span class="op">)</span></code>, <code class="sourceCode cpp"><em>cur_</em></code> with <code class="sourceCode cpp">std<span class="op">::</span>move<span class="op">(</span>current<span class="op">)</span></code>, and <code class="sourceCode cpp"><em>next_</em></code> with <code class="sourceCode cpp">std<span class="op">::</span>move<span class="op">(</span>next<span class="op">)</span></code>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb25-1"><a href="#cb25-1"></a>constexpr iterator_t&lt;V&gt; base() const &amp;</span>
<span id="cb25-2"><a href="#cb25-2"></a>  requires copyable&lt;iterator_t&lt;V&gt;&gt;;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">2</a></span> <em>Effects</em>: Equivalent to <code class="sourceCode cpp"><span class="cf">return</span> <em>cur_</em>;</code></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb26-1"><a href="#cb26-1"></a>constexpr iterator_t&lt;V&gt; base() &amp;&amp;;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">3</a></span> <em>Effects</em>: Equivalent to <code class="sourceCode cpp"><span class="cf">return</span> std<span class="op">::</span>move<span class="op">(</span><em>cur_</em><span class="op">)</span>;</code></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb27-1"><a href="#cb27-1"></a>constexpr value_type operator*() const;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">4</a></span> <em>Effects</em>: Equivalent to <code class="sourceCode cpp"><span class="cf">return</span> <span class="op">{</span><em>cur_</em>, <em>next_</em><span class="op">}</span>;</code></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb28-1"><a href="#cb28-1"></a>constexpr <em>iterator</em>&amp; operator++();</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">5</a></span> <em>Effects</em>: Equivalent to:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb29-1"><a href="#cb29-1"></a><em>cur_</em> <span class="op">=</span> <em>next_</em>;</span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="cf">if</span> <span class="op">(</span><em>cur_</em> <span class="op">!=</span> ranges<span class="op">::</span>end<span class="op">(</span><em>parent_</em><span class="op">-&gt;</span><em>base_</em><span class="op">))</span> <span class="op">{</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>    ranges<span class="op">::</span>advance<span class="op">(</span><em>cur_</em>, ranges<span class="op">::</span>distance<span class="op">(</span><em>parent_</em><span class="op">-&gt;</span><em>pattern_</em><span class="op">))</span>;</span>
<span id="cb29-4"><a href="#cb29-4"></a>    <span class="cf">if</span> <span class="op">(</span><em>cur_</em> <span class="op">==</span> ranges<span class="op">::</span>end<span class="op">(</span><em>parent_</em><span class="op">-&gt;</span><em>base_</em><span class="op">))</span> <span class="op">{</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>        <em>trailing_empty_</em> <span class="op">=</span> <span class="kw">true</span>;</span>
<span id="cb29-6"><a href="#cb29-6"></a>    <span class="op">}</span></span>
<span id="cb29-7"><a href="#cb29-7"></a>    <em>next_</em> <span class="op">=</span> <em>parent_</em><span class="op">-&gt;</span><em>find-next</em><span class="op">(</span><em>cur_</em><span class="op">)</span>;</span>
<span id="cb29-8"><a href="#cb29-8"></a><span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb29-9"><a href="#cb29-9"></a>    <em>trailing_empty_</em> <span class="op">=</span> <span class="kw">false</span>;</span>
<span id="cb29-10"><a href="#cb29-10"></a><span class="op">}</span></span>
<span id="cb29-11"><a href="#cb29-11"></a><span class="cf">return</span> <span class="op">*</span><span class="kw">this</span>;</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb30-1"><a href="#cb30-1"></a>constexpr <em>iterator</em> operator++(int);</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">6</a></span> <em>Effects</em>: Equivalent to:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">auto</span> tmp <span class="op">=</span> <span class="op">*</span><span class="kw">this</span>;</span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="op">++*</span><span class="kw">this</span>;</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="cf">return</span> tmp;</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb32-1"><a href="#cb32-1"></a>friend constexpr bool operator==(const <em>iterator</em>&amp; x, const <em>iterator</em>&amp; y)</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">7</a></span> <em>Effects</em>: Equivalent to:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb33-1"><a href="#cb33-1"></a><span class="cf">return</span> x<span class="op">.</span><em>cur_</em> <span class="op">==</span> y<span class="op">.</span><em>cur_</em> <span class="op">&amp;&amp;</span> x<span class="op">.</span><em>trailing_empty_</em> <span class="op">==</span> y<span class="op">.</span><em>trailing_empty_</em>;</span></code></pre></div>
</blockquote>
<h3 data-number="5.2.4" id="class-template-split_view_sentinel_-range.split2.sentinel"><span class="header-section-number">5.2.4</span> Class template <code class="sourceCode cpp">split_view​<span class="op">::</span><em>​sentinel</em></code> [range.split2.sentinel]<a href="#class-template-split_view_sentinel_-range.split2.sentinel" class="self-link"></a></h3>
<blockquote>
<div class="sourceCode" id="cb34"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb34-1"><a href="#cb34-1"></a>  <span class="kw">template</span><span class="op">&lt;</span>forward_range V, forward_range Pattern<span class="op">&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>    <span class="kw">requires</span> view<span class="op">&lt;</span>V<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> view<span class="op">&lt;</span>Pattern<span class="op">&gt;</span> <span class="op">&amp;&amp;</span></span>
<span id="cb34-3"><a href="#cb34-3"></a>             indirectly_comparable<span class="op">&lt;</span>iterator_t<span class="op">&lt;</span>V<span class="op">&gt;</span>, iterator_t<span class="op">&lt;</span>Pattern<span class="op">&gt;</span>, ranges<span class="op">::</span>equal_to<span class="op">&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4"></a>  <span class="kw">struct</span> split_view<span class="op">&lt;</span>V, Pattern<span class="op">&gt;::</span><em>sentinel</em> <span class="op">{</span></span>
<span id="cb34-5"><a href="#cb34-5"></a>  <span class="kw">private</span><span class="op">:</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>    sentinel_t<span class="op">&lt;</span>V<span class="op">&gt;</span> <em>end_</em> <span class="op">=</span> sentinel_t<span class="op">&lt;</span>V<span class="op">&gt;()</span>; <span class="co">// exposition only</span></span>
<span id="cb34-7"><a href="#cb34-7"></a>    </span>
<span id="cb34-8"><a href="#cb34-8"></a>  <span class="kw">public</span><span class="op">:</span></span>
<span id="cb34-9"><a href="#cb34-9"></a>    <em>sentinel</em><span class="op">()</span> <span class="op">=</span> <span class="cf">default</span>;</span>
<span id="cb34-10"><a href="#cb34-10"></a>    <span class="kw">constexpr</span> <span class="kw">explicit</span> <em>sentinel</em><span class="op">(</span>split_view<span class="op">&amp;</span> parent<span class="op">)</span>;</span>
<span id="cb34-11"><a href="#cb34-11"></a>    </span>
<span id="cb34-12"><a href="#cb34-12"></a>    <span class="kw">friend</span> <span class="kw">constexpr</span> <span class="dt">bool</span> <span class="kw">operator</span><span class="op">==(</span><span class="kw">const</span> <em>iterator</em><span class="op">&amp;</span> x, <span class="kw">const</span> <em>sentinel</em><span class="op">&amp;</span> y<span class="op">)</span>;</span>
<span id="cb34-13"><a href="#cb34-13"></a>  <span class="op">}</span>;</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb35-1"><a href="#cb35-1"></a>constexpr explicit <em>sentinel</em>(split_view&amp; parent);</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">1</a></span> <em>Effects</em>: Initializes <code class="sourceCode cpp"><em>end_</em></code> with <code class="sourceCode cpp">ranges​<span class="op">::</span>​end<span class="op">(</span>parent<span class="op">.</span><em>base_</em><span class="op">)</span></code>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb36-1"><a href="#cb36-1"></a>friend constexpr bool operator==(const <em>iterator</em>&amp; x, const <em>sentinel</em>&amp; y);</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">2</a></span> <em>Effects</em>: Equivalent to: <code class="sourceCode cpp"><span class="cf">return</span> x<span class="op">.</span><em>cur_</em> <span class="op">==</span> y<span class="op">.</span><em>end_</em> <span class="op">&amp;&amp;</span> <span class="op">!</span>x<span class="op">.</span><em>trailing_empty_</em>;</code></p>
</blockquote>
<h1 data-number="6" style="border-bottom:1px solid #cccccc" id="bibliography"><span class="header-section-number">6</span> References<a href="#bibliography" class="self-link"></a></h1>
<div id="refs" class="references hanging-indent" role="doc-bibliography">
<div id="ref-issue385">
<p>[issue385] Casey Carter. 2016. <code class="sourceCode cpp"><span class="kw">const</span></code>-ness of view operations. <br />
<a href="https://github.com/ericniebler/range-v3/issues/385">https://github.com/ericniebler/range-v3/issues/385</a></p>
</div>
<div id="ref-LWG3478">
<p>[LWG3478] Barry Revzin. views::split drops trailing empty range. <br />
<a href="https://wg21.link/lwg3478">https://wg21.link/lwg3478</a></p>
</div>
<div id="ref-LWG3505">
<p>[LWG3505] Tim Song. split_view::outer-iterator::operator++ misspecified. <br />
<a href="https://wg21.link/lwg3505">https://wg21.link/lwg3505</a></p>
</div>
<div id="ref-P1989R0">
<p>[P1989R0] Corentin Jabot. 2019-11-25. Range constructor for std::string_view 2: Constrain Harder. <br />
<a href="https://wg21.link/p1989r0">https://wg21.link/p1989r0</a></p>
</div>
<div id="ref-P2210R0">
<p>[P2210R0] Barry Revzin. 2020-08-14. Superior String Splitting. <br />
<a href="https://wg21.link/p2210r0">https://wg21.link/p2210r0</a></p>
</div>
<div id="ref-P2214R0">
<p>[P2214R0] Barry Revzin, Conor Hoekstra, Tim Song. 2020-10-15. A Plan for C++23 Ranges. <br />
<a href="https://wg21.link/p2214r0">https://wg21.link/p2214r0</a></p>
</div>
<div id="ref-revzin.split">
<p>[revzin.split] Barry Revzin. 2020. Implementing a better views::split. <br />
<a href="https://brevzin.github.io/c++/2020/07/06/split-view/">https://brevzin.github.io/c++/2020/07/06/split-view/</a></p>
</div>
<div id="ref-revzin.split.impl">
<p>[revzin.split.impl] Barry Revzin. 2020. Implementation of <code class="sourceCode cpp">split2_view</code>. <br />
<a href="https://godbolt.org/z/hanc46">https://godbolt.org/z/hanc46</a></p>
</div>
</div>
</div>
</div>
</body>
</html>
